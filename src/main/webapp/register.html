<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="renderer" content="webkit">

    <title>注册</title>
    <meta name="keywords">
    <meta name="description">

    <link href="css/bootstrap.min.css?v=3.4.0" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css?v=4.3.0" rel="stylesheet">
    <link href="css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css?v=2.2.0" rel="stylesheet">

</head>

<body class="gray-bg">

    <div class="middle-box text-center loginscreen   animated fadeInDown">
        <div>
            <div>
                <h1 class="logo-name">666</h1>
            </div>
            <h3>欢迎注册</h3>
            <h2>创建一个化工实验室账户</h2>
<!--            <form id="registerForm" class="m-t" role="form" action="login.html" >-->
            <form id="registerForm" class="m-t" role="form" method="post" accept-charset="utf-8" action="login.html">
                <div>
                    <tr>
                        <label for="status">身份:</label>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" id="status" name="status" value="负责人">负责人
                        </td>
                        <td>
                            <input type="radio" name="status" value="审批人"> 审批人
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="status" value="仓库管理员"> 仓库管理员
                        </td>
                        <td>
                            <input type="radio" name="status" value="用户" checked> 用户
                        </td>
                    </tr>
                </div>

                <div class="form-group">
                    <input type="text" id="account" class="form-control" placeholder="请输入账号" required="">
                </div>
                <div class="form-group">
                    <input type="password" id="password" class="form-control" placeholder="请输入密码" required="">
                </div>
                <div class="form-group">
                    <input type="password" id="repassword" class="form-control" placeholder="请再次输入密码" required="">
                </div>
                <div class="form-group">
                    <input type="text" id="name" class="form-control" placeholder="请输入真实姓名" required="">
                </div>
                <div class="form-group">
                    <input type="text" id="email" class="form-control" placeholder="请输入电子邮箱" required="">
                </div>
                <div class="form-group">
                    <input type="text" id="phonenumber" class="form-control" placeholder="请输入手机号" required="">
                </div>
                <div class="form-group text-left">
                    <div class="checkbox i-checks">
                        <label class="no-padding">
                            <input type="checkbox"><i></i> 我同意注册协议</label>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary block full-width m-b">注 册</button>

                <p class="text-muted text-center"><small>已经有账户了？</small><a href="login.html">点此登录</a>
                </p>

            </form>
        </div>
    </div>

    <!-- Mainly scripts -->
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/bootstrap.min.js?v=3.4.0"></script>
    <script>
        //1. 验证账号是否符合规则
        //1.1 获取账号的输入框
        let accountElement = document.getElementById("account");
        //1.2 绑定onblur事件 失去焦点
        accountElement.onblur = checkAccount;
        function checkAccount() {
            //1.2 获取账号值
            let account = accountElement.value.trim();
            //1.3 定义正则
            var account_reg = /^\w{3,12}$/;
            //1.4 判断，给出提示信息
            var flag = account_reg.test(account);
            if (flag) {
                //账号合法
                accountElement.style.border = "";
            } else {
                //账号非法,加一个红色边框
                accountElement.style.border = "1px solid red";
            }
            return flag;
        }

        //2. 验证密码是否符合规则
        let passwordElement = document.getElementById("password");
        passwordElement.onblur = checkPassword;
        function checkPassword() {
            var password = passwordElement.value.trim();  //获取值
            var reg_password = /^\w{3,20}$/  //单词类型\w，8-20用{}
            var flag = reg_password.test(password);
            if(flag) {
                //校验通过
                passwordElement.style.border = "";
            } else {
                //校验失败
                passwordElement.style.border = "1px solid red";
            }
            return flag;
        }

        //3. 验证再次输入的密码是否符合规则
        let repasswordElement = document.getElementById("repassword");
        repasswordElement.onblur = checkRepassword;
        function checkRepassword() {
            var password = passwordElement.value.trim();
            var repassword = repasswordElement.value.trim();
            var flag = null;
            if(password == repassword&&password!=null) {
                //校验通过
                flag = true;
                repasswordElement.style.border = "";
            } else {
                //校验失败
                flag = false;
                repasswordElement.style.border = "1px solid red";
            }
            return flag;
        }

        //4. 验证姓名是否符合规则
        let nameElement = document.getElementById("name");
        nameElement.onblur = checkName;
        function checkName() {
            var name = nameElement.value.trim();  //获取值
            var reg_name = /^[\s\S]*.*[^\s][\s\S]*$/  //单词类型\w，1-10用{}
            var flag = reg_name.test(name);
            if(flag) {
                //校验通过
                nameElement.style.border = "";
            } else {
                //校验失败
                nameElement.style.border = "1px solid red";
            }
            return flag;
        }

        //5. 校验邮箱
        let emailElement = document.getElementById("email");
        emailElement.onblur = checkEmail;
        function checkEmail() {
            var email = emailElement.value.trim();   //获取值
            var reg_email = /^\w+@\w+\.\w+$/  //单词类型\w，8-20用{}
            var flag = reg_email.test(email);
            if (flag) {
                //校验通过
                emailElement.style.border = "";
            } else {
                //校验失败
                emailElement.style.border = "1px solid red";
            }
            return flag;
        }

        //6. 验证手机号是否符合规则
        let phonenumberElement = document.getElementById("phonenumber");
        phonenumberElement.onblur = checkTel;
        function checkTel() {
            var phonenumber = phonenumberElement.value.trim();   //获取值
            var reg_phonenumber = /^1[0-9]{10}$/
            var flag = reg_phonenumber.test(phonenumber);
            if(flag) {
                //校验通过
                phonenumberElement.style.border = "";
            } else {
                //校验失败
                phonenumberElement.style.border = "1px solid red";
            }
            return flag;
        }

        $(function () {
            $("#registerForm").submit(function () {
                var front_end_data = "account="+$("#account").val()+
                                     "&password="+$("#password").val()+
                                     "&name="+$("#name").val()+
                                     "&phonenumber="+$("#phonenumber").val()+
                                     "&email="+$("#email").val();
                if (checkAccount() && checkPassword() && checkName() && checkRepassword() && checkEmail() && checkTel()) {
                    $.post("user/regist",front_end_data, function (data) {
                        // 处理服务器响应的结果:从服务器响应的data格式： {flag:true,errorMsg:"注册失败"}
                        alert("data.flag="+data.flag);
                        if (data.flag) {
                            // 注册成功，跳转成功页面
                            location.href = "login.html";
                        } else {
                            // 注册失败,给errorMsg添加提示信息
                            alert("errormsg="+data.errorMsg);
                            $("#errorMsg").html(data.errorMsg);
                        }
                    });
                }
                return false;
            });

            $("#account").blur(checkAccount);
            $("#name").blur(checkName);
            $("#email").blur(checkEmail);
            $("#password").blur(checkPassword);
            $("#repassword").blur(checkRepassword);
            $("#phonenumber").blur(checkTel);


            var registIdentity = $("input[type='radio']:checked").val();
            var registId = null;
            switch(registIdentity){
                case "负责人":
                    registId = 1;
                    alert(registIdentity);
                    break;
                case "仓库管理员":
                    registId = 2;
                    alert(registIdentity);
                    break;
                case "审批人":
                    registId = 3;
                    alert(registIdentity);
                    break;
                default:
                    alert(registIdentity);
                    break;
            }


        });
    </script>

</body>

</html>
