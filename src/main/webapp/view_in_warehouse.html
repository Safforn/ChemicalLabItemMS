<!DOCTYPE html>
<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="renderer" content="webkit">

  <title>查看出库单</title>
  <meta name="keywords">
  <meta name="description">

  <link href="css/bootstrap.min.css?v=3.4.0" rel="stylesheet">
  <link href="font-awesome/css/font-awesome.css?v=4.3.0" rel="stylesheet">
  <link href="css/plugins/iCheck/custom.css" rel="stylesheet">
  <link href="css/animate.css" rel="stylesheet">
  <link href="css/style.css?v=2.2.0" rel="stylesheet">

</head>

<body>
<div id="wrapper">
  <!-- 侧边栏 -->
  <div id="left_sidebar"></div>

  <div id="page-wrapper" class="gray-bg dashbard-1">
    <!--头部-->
    <div id="header"></div>
    <div class="row wrapper border-bottom white-bg page-heading">
      <div class="col-lg-10">
        <h2>查看入库单</h2>

      </div>
      <div class="col-lg-2">

      </div>
    </div>
    <div class="wrapper wrapper-content animated fadeInRight">
      <!--                所有表单元素  -->
      <div class="row">
        <div class="col-lg-12">
          <div class="ibox float-e-margins">
            <div class="ibox-content">
              <form method="get" class="form-horizontal">
                <div class="form-group">
                  <div class="row">
                    <div class="col-lg-12">
                      <div class="ibox float-e-margins">
                        <div class="ibox-title">
                          <h5>入库物品清单</h5>
                          <div class="ibox-tools">
                            <a class="collapse-link">
                              <i class="fa fa-chevron-up"></i>
                            </a>
                          </div>
                        </div>
                        <div class="ibox-content">

                          <table id=exTable class="table table-striped table-bordered table-hover dataTables-example">

                          </table>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>

              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 数据表单弹窗 -->
    <form method="post" class="form-horizontal" role="form" id="updateGoodsForm">
      <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width: 1400px">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                ×
              </button>
              <h4 class="modal-title" id="updateModalLabel">
                物品清单
              </h4>
            </div>

            <div class="form-group">
              <div class="row">
                <div class="col-lg-12">
                  <div class="ibox float-e-margins">
                    <div class="ibox-content">

                      <table id=listTable class="table table-striped table-bordered table-hover dataTables-example">

                      </table>

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>


        </div><!-- /.modal-content -->
      </div><!-- /.modal -->

    </form>


  </div>
</div>




<!-- Mainly scripts -->
<script src="js/jquery-2.1.1.min.js"></script>
<script src="js/bootstrap.min.js?v=3.4.0"></script>
<script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="js/hplus.js?v=2.2.0"></script>
<script src="js/plugins/pace/pace.min.js"></script>

<!-- iCheck -->
<script src="js/plugins/iCheck/icheck.min.js"></script>
<!-- Data Tables -->
<script src="js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="js/plugins/dataTables/dataTables.bootstrap.js"></script>

<!-- Custom and plugin javascript -->
<script src="js/hplus.js?v=2.2.0"></script>
<script src="js/plugins/pace/pace.min.js"></script>

<!-- Page-Level Scripts -->
<!-- 导入header -->
<script>
  $(function () {
    $.get("header.html",function (data) {
      $("#header").html(data);
    });
  });
</script>
<!-- 导入left_sidebar -->
<script>
  $(function () {
    $.get("left_sidebar.html",function (data) {
      $("#left_sidebar").html(data);
    });

  });
</script>

<script>

  var temp_data;

  console.log("--flag-1-");

  // 初始化，获取首页表格数据
  $.ajax({
    async: false,
    data: {},
    type : "post",
    url : "inWarehouse/searchAllPurchaseRequisition",
    success : function(data) {
      console.log("--flag-inittable-");
      temp_data=data.data;
    }
  });
  console.log("|temp_data=\n"+temp_data)

  function json2Array(jsonData, list_or_not) {
    var jsonsString = jsonData.slice(1, jsonData.length - 1);
    var jsonStrings = jsonsString.split("},");
    var length = jsonStrings.length;
    var jsons = [];
    for (var i = 0; i !== length-1; ++i) {
      jsonStrings[i] += '}';
    }
    var source = [[]];
    for (var i = 0; i !== length; ++i) {
      //console.log("$"+jsonStrings[i]);
      jsons[i] = eval('(' + jsonStrings[i] + ')');
      var data = [];
      for(var key in jsons[i]) {
        if(i === 0) {
          source[0].push(key);
        }
        //console.log("i="+i+"|key="+key+"|json[i,key]="+jsons[i][key]);
        if(!list_or_not || key !== "object_id" ) {
          data.push(jsons[i][key]);
        } else {
          console.log("跳过在执行一次")
        }
      }
      source.push(data);
    }
    return source.slice(1); //删除第1行
  }
  //console.log("temp_data=\n"+temp_data);
  temp_data = json2Array(temp_data, false)


  const dataSets = [];
  $(document).ready(function (){
    $('#exTable').DataTable({
      retrieve: true,
      data:dataSet,
      columns:[
        {
          'field': "ex_warehouse_id",
          'title': '入库单id',
          'defaultContent' : ""
        }, {
          'field': "ex_order_id",
          'title': '入库物品清单id',
          'defaultContent' : ""
        }, {
          'field': "warehouse_id",
          'title': '仓库编号',
          'defaultContent' : ""
        }, {
          'field': "requisition_id",
          'title': '申请单id',
          'defaultContent' : ""
        }, {
          'field': "type",
          'title': '入库类型',
          'defaultContent' : ""
        }, {
          'field': "date",
          'title': '入库时间',
          'defaultContent' : ""
        }, {
          'field': "notes",
          'title': '备注',
          'defaultContent' : ""
        }, {
          field: "operate",
          sTitle: '操作',
          sDefaultContent : "",
          sClass: 'text-center',
          "targets" : 1,//操作按钮目标列
          "data" : null,
          "render" : function(data, type,row) {
            var id = '"' + row.id + '"';
            var html = "<a href='javascript:void(0);'  class='btn btn-primary btn-xs'  onclick='EditViewById()'></i>物品清单</a>"
            return html;
            // formatter: actionFormatter
          }
        }]
    });

    $('#listTable').DataTable({
      retrieve: true,
      data:dataSets,
      columns:[
        {
          'field': "object_id",
          'title': '物品id',
          'defaultContent' : ""
        }, {
          'field': "name",
          'title': '物品名称',
          'defaultContent' : ""
        }, {
          'field': "specification",
          'title': '规格',
          'defaultContent' : ""
        }, {
          'field': "quantity",
          'title': '数量',
          'defaultContent' : ""
        }, {
          'field': "unit",
          'title': '包装单位',
          'defaultContent' : ""
        }, {
          'field': "classification",
          'title': '分类',
          'defaultContent' : ""
        }, {
          'field': "price",
          'title': '单价',
          'defaultContent' : ""
        }, {
          'field': "expiration_time",
          'title': '过期时间',
          'defaultContent' : ""
        }, {
          'field': "upper_limit",
          'title': '警戒上限',
          'defaultContent' : ""
        }, {
          'field': "lower_limit",
          'title': '警戒下限',
          'defaultContent' : ""
        }, {
          'field': "warehouse_id",
          'title': '仓库',
          'defaultContent' : ""
        }, {
          'field': "notes",
          'title': '备注',
          'defaultContent' : ""
        }]
    });

  });

  //getData方法获取全部页面数据后，将data转为json对象，使用index当前行号作为下标获取对应数据
  function EditViewById(){
    //弹出修改表单（非模态框）
    $('#updateModal').modal('show');
  }


</script>


</body>

</html>
