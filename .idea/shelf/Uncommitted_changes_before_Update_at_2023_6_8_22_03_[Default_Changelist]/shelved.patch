Index: src/main/webapp/form_waste.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><meta name=\"renderer\" content=\"webkit\">\r\n\r\n    <title>废弃申请表</title>\r\n    <meta name=\"keywords\" >\r\n    <meta name=\"description\">\r\n\r\n    <link href=\"css/bootstrap.min.css?v=3.4.0\" rel=\"stylesheet\">\r\n    <link href=\"font-awesome/css/font-awesome.css?v=4.3.0\" rel=\"stylesheet\">\r\n    <link href=\"css/plugins/iCheck/custom.css\" rel=\"stylesheet\">\r\n    <link href=\"css/animate.css\" rel=\"stylesheet\">\r\n    <link href=\"css/style.css?v=2.2.0\" rel=\"stylesheet\">\r\n</head>\r\n<body>\r\n    <div id=\"wrapper\">\r\n        <!-- 侧边栏 -->\r\n        <div id=\"left_sidebar\"></div>\r\n        <div id=\"page-wrapper\" class=\"gray-bg dashbard-1\">\r\n            <!--头部-->\r\n            <div id=\"header\"></div>\r\n            <!--标题-->\r\n            <div class=\"row wrapper border-bottom white-bg page-heading\">\r\n                <div class=\"col-lg-10\">\r\n                    <h2>废弃申请表</h2>\r\n                </div>\r\n                <div class=\"col-lg-2\">\r\n\r\n            </div>\r\n        </div>\r\n            <!-- 表单本体 -->\r\n        <div class=\"wrapper wrapper-content animated fadeInRight\">\r\n\r\n            <div class=\"row\">\r\n                <div class=\"col-lg-12\">\r\n                    <div class=\"ibox float-e-margins\">\r\n                        <div class=\"ibox-title\">\r\n                            <h5>废弃申请表</h5>\r\n                            <div class=\"ibox-tools\">\r\n                                <a class=\"collapse-link\">\r\n                                    <i class=\"fa fa-chevron-up\"></i>\r\n                                </a>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"ibox-content\">\r\n                            <form method=\"get\" class=\"form-horizontal\">\r\n\r\n                                <div class=\"row\">\r\n                                    <div class=\"col-lg-12\">\r\n                                        <div class=\"ibox float-e-margins\">\r\n\r\n                                            <div class=\"ibox-content\">\r\n                                                <div class=\"\">\r\n                                                    <a onclick=\"fnClickAddRow();\" href=\"javascript:void(0);\" class=\"btn btn-primary \">新建废弃申请</a>\r\n                                                    <button type=\"button\" id=\"batch-edit-btn\" class=\"btn btn-primary \">批量编辑</button>\r\n                                                    <button type=\"button\" id=\"batch-save-btn\" class=\"btn btn-primary \">批量保存</button>\r\n                                                </div>\r\n\r\n\r\n                                                <table id=\"table\" class=\"datatable table table-striped table-bordered table-hover\">\r\n\r\n                                                </table>\r\n\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </form>\r\n                        </div>\r\n\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- 数据表单弹窗 -->\r\n        <form method=\"post\" class=\"form-horizontal\" role=\"form\" id=\"updateGoodsForm\">\r\n            <div class=\"modal fade\" id=\"updateModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"updateModalLabel\" aria-hidden=\"true\">\r\n                <div class=\"modal-dialog\" style=\"width: 1400px\">\r\n                    <div class=\"modal-content\">\r\n                        <div class=\"modal-header\">\r\n                            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">\r\n                                ×\r\n                            </button>\r\n                            <h4 class=\"modal-title\" id=\"updateModalLabel\">\r\n                                物品清单\r\n                            </h4>\r\n                        </div>\r\n\r\n                        <div class=\"form-group\">\r\n                            <div class=\"row\">\r\n                                <div class=\"col-lg-12\">\r\n                                    <div class=\"ibox float-e-margins\">\r\n                                        <div class=\"ibox-content\">\r\n\r\n                                            <div class=\"\">\r\n                                                <button onclick=\"listfnClickAddRow();\" href=\"javascript:void(0);\" class=\"list-top-btn btn btn-primary \">添加物品</button>\r\n                                                <button type=\"button\" id=\"list-batch-edit-btn\" class=\"list-top-btn btn btn-primary \">批量编辑</button>\r\n                                                <button type=\"button\" id=\"list-batch-save-btn\" class=\"list-top-btn btn btn-primary \">批量保存</button>\r\n                                            </div>\r\n\r\n                                            <table id=listTable width=\"100%\" class=\"table table-striped table-bordered table-hover dataTables-example\">\r\n\r\n                                            </table>\r\n\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                        </div>\r\n                    </div>\r\n                    <!--   end modal-body  -->\r\n\r\n                </div><!-- /.modal-content -->\r\n            </div><!-- /.modal -->\r\n\r\n        </form>\r\n\r\n\r\n\r\n    </div>\r\n</div>\r\n\r\n\r\n\r\n\r\n<!-- Mainly scripts -->\r\n<script src=\"js/jquery-2.1.1.min.js\"></script>\r\n<script src=\"js/bootstrap.min.js?v=3.4.0\"></script>\r\n<script src=\"js/plugins/metisMenu/jquery.metisMenu.js\"></script>\r\n<script src=\"js/plugins/slimscroll/jquery.slimscroll.min.js\"></script>\r\n\r\n<!-- Custom and plugin javascript -->\r\n<script src=\"js/hplus.js?v=2.2.0\"></script>\r\n<script src=\"js/plugins/pace/pace.min.js\"></script>\r\n\r\n<!-- iCheck -->\r\n<script src=\"js/plugins/iCheck/icheck.min.js\"></script>\r\n\r\n<!--&lt;!&ndash;引入JavaScript&ndash;&gt;-->\r\n<script type=\"text/javascript\" language=\"javascript\" src=\"https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js\"></script>\r\n\r\n\r\n<!-- Data Tables -->\r\n<script src=\"js/plugins/dataTables/jquery.dataTables.js\"></script>\r\n<script src=\"js/plugins/dataTables/dataTables.bootstrap.js\"></script>\r\n\r\n<!--&lt;!&ndash;引入css&ndash;&gt;-->\r\n<!--<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css\">-->\r\n\r\n<!--&lt;!&ndash;&lt;!&ndash;引入JavaScript&ndash;&gt;&ndash;&gt;-->\r\n<!--<script type=\"text/javascript\" language=\"javascript\" src=\"//code.jquery.com/jquery-1.12.4.js\"></script>-->\r\n<!--<script type=\"text/javascript\" language=\"javascript\" src=\"https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js\"></script>-->\r\n\r\n\r\n\r\n<!--初始化代码-->\r\n<!-- 导入header -->\r\n<script>\r\n    $(function () {\r\n        $.get(\"header.html\",function (data) {\r\n            $(\"#header\").html(data);\r\n        });\r\n    });\r\n</script>\r\n<script>\r\n    $(function () {\r\n        $.get(\"left_sidebar.html\",function (data) {\r\n            $(\"#left_sidebar\").html(data);\r\n        });\r\n    });\r\n</script>\r\n<script>\r\n    const dataSet = [\r\n        ['id', 'aaa', 'bb', '30', 'xxxx-xx','30', '1'],\r\n        ['id1', 'aaa1', 'cc', '20', 'xxxx-xx','30', '2'],\r\n        ['id2', 'aaa', 'bb', '30', 'xxxx-xx','30', '3'],\r\n        ['id3', 'aaa1', 'cc', '20', 'xxxx-xx','30', '0'],\r\n        ['id4', 'aaa', 'bb', '30', 'xxxx-xx','30', '1'],\r\n        ['id5', 'aaa1', 'cc', '20', 'xxxx-xx','30', '2'],\r\n        ['id6', 'aaa', 'bb', '30', 'xxxx-xx','30', '3'],\r\n        ['id7', 'aaa1', 'cc', '20', 'xxxx-xx','30', '0'],\r\n        ['id8', 'aaa', 'bb', '30', 'xxxx-xx','30', '3'],\r\n        ['id9', 'aaa1', 'cc', '20', 'xxxx-xx','30', '2'],\r\n    ];\r\n    const dataSets = [\r\n        ['aaa', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa1', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa2', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa3', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa4', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa5', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa6', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa7', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa8', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa9', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa10', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa11', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa12', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa13', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa14', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n        ['aaa15', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],\r\n    ];\r\n    $(document).ready(function() {\r\n        $(function(){\r\n            var table = $('#table').DataTable({\r\n                retrieve: true,\r\n                data:dataSet,\r\n                columns:[\r\n                    {\r\n                        'field': \"waste_requisition_id\",\r\n                        'title': '废弃申请表编号',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"waste_order_id\",\r\n                        'title': '废弃物品清单编号',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"waste_user_id\",\r\n                        'title': '申请人',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"waste_reason\",\r\n                        'title': '废弃原因',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"waste_position\",\r\n                        'title': '废弃物存放位置',\r\n                        'defaultContent' : \"\"\r\n                    },{\r\n                        'field': \"requisition_date\",\r\n                        'title': '申请提交日期',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"state\",\r\n                        'title': '申请当前状态',\r\n                        'defaultContent' : \"0\"\r\n                    }, {\r\n                        'field': \"approval_user_id\",\r\n                        'title': '审批人',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"approval_opinions\",\r\n                        'title': '审批意见',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"approval_date\",\r\n                        'title': '审批日期',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        field: \"operate\",\r\n                        sTitle: '操作',\r\n                        sDefaultContent : \"<button class='submit-btn btn btn-primary btn-xs' type='button' >提交</button>\"+\r\n                            \"<button class='edit-btn btn btn-primary btn-xs' type='button' style='margin-left: 10px'>编辑</button>\"  +\r\n                            \"<button class='list-btn btn btn-primary btn-xs' type='button' style='margin-left: 10px'>物品清单</button>\"+\r\n                            \"<button class='delete btn btn-default btn-xs' style='margin-left: 10px'>删除</button>\",\r\n                        sClass: 'text-center',\r\n                        \"data\" : null,\r\n                        // \"render\" : function(data, type,row) {\r\n                        //     var id = '\"' + row.id + '\"';\r\n                        //     var html = \"<a href='javascript:void(0);'  class='btn btn-primary btn-xs'  onclick='EditViewById()'></i>物品清单</a>\"\r\n                        //     return html;\r\n                        //     // formatter: actionFormatter\r\n                        // }\r\n                    }],\r\n                \"language\": {\r\n                    \"sProcessing\": \"处理中...\",\r\n                    \"sLengthMenu\": \"显示 _MENU_ 项结果\",\r\n                    \"sZeroRecords\": \"没有匹配结果\",\r\n                    \"sInfo\": \"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项\",\r\n                    \"sInfoEmpty\": \"显示第 0 至 0 项结果，共 0 项\",\r\n                    \"sInfoFiltered\": \"(由 _MAX_ 项结果过滤)\",\r\n                    \"sInfoPostFix\": \"\",\r\n                    \"sSearch\": \"搜索:\",\r\n                    \"sUrl\": \"\",\r\n                    \"sEmptyTable\": \"表中数据为空\",\r\n                    \"sLoadingRecords\": \"载入中...\",\r\n                    \"sInfoThousands\": \",\",\r\n                    \"oPaginate\": {\r\n                        \"sFirst\": \"首页\",\r\n                        \"sPrevious\": \"上页\",\r\n                        \"sNext\": \"下页\",\r\n                        \"sLast\": \"末页\"\r\n                    },\r\n                    \"oAria\": {\r\n                        \"sSortAscending\": \": 以升序排列此列\",\r\n                        \"sSortDescending\": \": 以降序排列此列\"\r\n                    }\r\n                }\r\n            });\r\n\r\n            var listtable = $('#listTable').DataTable({\r\n                retrieve: true,\r\n                data:dataSets,\r\n                columns:[\r\n                    {\r\n                        'field': \"name\",\r\n                        'title': '物品名称',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"specification\",\r\n                        'title': '规格',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"quantity\",\r\n                        'title': '数量',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"unit\",\r\n                        'title': '包装单位',\r\n                        'defaultContent' : \"\",\r\n\r\n\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"classification\",\r\n                        'title': '分类',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"price\",\r\n                        'title': '单价',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"expiration_time\",\r\n                        'title': '过期时间',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"upper_limit\",\r\n                        'title': '警戒上限',\r\n                        // width:90,\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"lower_limit\",\r\n                        'title': '警戒下限',\r\n                        // width:90,\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"warehouse_id\",\r\n                        'title': '仓库',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"notes\",\r\n                        'title': '备注',\r\n                        'defaultContent' : \"\",\r\n                        width:150,\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        field: \"operate\",\r\n                        sTitle: '操作',\r\n                        sDefaultContent : \"<button class='list-edit-btn btn btn-primary btn-xs' type='button'>编辑</button>\" +\r\n                            \"<button class='list-delete btn btn-default btn-xs' style='margin-left: 10px'>删除</button>\",\r\n                        sClass: 'text-center',\r\n                        // width:100,\r\n                        \"data\" : null,\r\n                        // \"render\" : function(data, type,row) {\r\n                        //   var html = \"<a href='javascript:void(0);'  class='edit-btn btn btn-primary btn-xs' type='button'>修改</a>\"\r\n                        //   // TODO: 按钮的修改功能\r\n                        //   html += \"<a href='javascript:void(0);'  class='delete btn btn-default btn-xs'>删除</a>\"\r\n                        //   return html;\r\n                        //   // formatter: actionFormatter\r\n                        // }\r\n                    }],\r\n                \"language\": {\r\n                    \"sProcessing\": \"处理中...\",\r\n                    \"sLengthMenu\": \"显示 _MENU_ 项结果\",\r\n                    \"sZeroRecords\": \"没有匹配结果\",\r\n                    \"sInfo\": \"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项\",\r\n                    \"sInfoEmpty\": \"显示第 0 至 0 项结果，共 0 项\",\r\n                    \"sInfoFiltered\": \"(由 _MAX_ 项结果过滤)\",\r\n                    \"sInfoPostFix\": \"\",\r\n                    \"sSearch\": \"搜索:\",\r\n                    \"sUrl\": \"\",\r\n                    \"sEmptyTable\": \"表中数据为空\",\r\n                    \"sLoadingRecords\": \"载入中...\",\r\n                    \"sInfoThousands\": \",\",\r\n                    \"oPaginate\": {\r\n                        \"sFirst\": \"首页\",\r\n                        \"sPrevious\": \"上页\",\r\n                        \"sNext\": \"下页\",\r\n                        \"sLast\": \"末页\"\r\n                    },\r\n                    \"oAria\": {\r\n                        \"sSortAscending\": \": 以升序排列此列\",\r\n                        \"sSortDescending\": \": 以降序排列此列\"\r\n                    }\r\n                }\r\n            });\r\n\r\n            //点击物品清单\r\n            $(\"table tbody\").on(\"click\",\".list-btn\",function (){\r\n                // $('#listTable').dataTable().api().draw();\r\n                // $('#listTable').dataTable().reload();\r\n                var tds=$(this).parents(\"tr\").children();\r\n                var arr = tds[6].innerText;\r\n                console.log(arr);\r\n                if(arr==='已提交'||arr==='审核通过'){\r\n                    $('.list-edit-btn').attr('disabled',true);\r\n                    $('.list-delete').attr('disabled',true);\r\n                    $('.list-top-btn').attr('disabled',true);\r\n                }\r\n                if(arr==='未提交'||arr==='审核未通过'){\r\n                    $('.list-edit-btn').attr('disabled',false);\r\n                    $('.list-delete').attr('disabled',false);\r\n                    $('.list-top-btn').attr('disabled',false);\r\n                }\r\n\r\n                $('#updateModal').modal('show');\r\n            })\r\n\r\n            //点击提交按钮\r\n            $(\"table tbody\").on(\"click\",\".submit-btn\",function (){\r\n                var tds=$(this).parents(\"tr\").children();\r\n                var arr = tds[6].innerText;\r\n                console.log(arr);\r\n                if(arr==='未提交'||arr==='审核未通过'){\r\n\r\n                    //提交的代码\r\n                    if(confirm('确认提交申请？')){\r\n                        //点击确认\r\n                        tds[6].innerText = '已提交';\r\n                        $(this).attr('disabled',true);\r\n                        tds.find('.edit-btn').attr('disabled',true);\r\n                    }else{\r\n                        //点击取消\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            })\r\n\r\n            // 申请表修改\r\n            $(\"#table tbody\").on(\"click\",\".edit-btn\",function(){\r\n                var tds=$(this).parents(\"tr\").children();\r\n                $.each(tds, function(i,val){\r\n                    var jqob=$(val);\r\n                    if(i<=2||i>4 ){return true;}//跳过第1项 序号,按钮\r\n                    var txt=jqob.text();\r\n                    var put=$(\"<input type='text' style='width: 80px'>\");\r\n                    put.val(txt);\r\n                    jqob.html(put);\r\n                });\r\n                $(this).html(\"保存\");\r\n                $(this).toggleClass(\"edit-btn\");\r\n                $(this).toggleClass(\"save-btn\");\r\n            });\r\n\r\n            //申请表修改保存\r\n            $(\"#table tbody\").on(\"click\",\".save-btn\",function(){\r\n                var row=table.row($(this).parents(\"tr\"));\r\n                var tds=$(this).parents(\"tr\").children();\r\n                $.each(tds, function(i,val){\r\n                    var jqob=$(val);\r\n                    //把input变为字符串\r\n                    console.log(!jqob.has('button').length);\r\n                    if(!jqob.has('button').length){\r\n                        var txt=jqob.children(\"input\").val();\r\n                        console.log(jqob.children(\"input\"));\r\n                        jqob.html(txt);\r\n                        table.cell(jqob).data(txt);//修改DataTables对象的数据\r\n                    }\r\n                });\r\n                $(this).html(\"编辑\");\r\n                $(this).toggleClass(\"edit-btn\");\r\n                $(this).toggleClass(\"save-btn\");\r\n            });\r\n\r\n            // 物品清单修改\r\n            $(\"#listTable tbody\").on(\"click\",\".list-edit-btn\",function(){\r\n                var tds=$(this).parents(\"tr\").children();\r\n                $.each(tds, function(i,val){\r\n                    var jqob=$(val);\r\n                    if(jqob.has('button').length ){return true;}//跳过第1项 序号,按钮\r\n                    var txt=jqob.text();\r\n                    var put=$(\"<input type='text' style='width: 80px'>\");\r\n                    put.val(txt);\r\n                    jqob.html(put);\r\n                });\r\n                $(this).html(\"保存\");\r\n                $(this).toggleClass(\"list-edit-btn\");\r\n                $(this).toggleClass(\"list-save-btn\");\r\n            });\r\n\r\n            //物品清单修改保存\r\n            $(\"#listTable tbody\").on(\"click\",\".list-save-btn\",function(){\r\n                var row=listtable.row($(this).parents(\"tr\"));\r\n                var tds=$(this).parents(\"tr\").children();\r\n                $.each(tds, function(i,val){\r\n                    var jqob=$(val);\r\n                    //把input变为字符串\r\n                    console.log(!jqob.has('button').length);\r\n                    if(!jqob.has('button').length){\r\n                        var txt=jqob.children(\"input\").val();\r\n                        console.log(jqob.children(\"input\"));\r\n                        jqob.html(txt);\r\n                        listtable.cell(jqob).data(txt);//修改DataTables对象的数据\r\n                    }\r\n                });\r\n                $(this).html(\"编辑\");\r\n                $(this).toggleClass(\"list-edit-btn\");\r\n                $(this).toggleClass(\"list-save-btn\");\r\n            });\r\n\r\n            //批量点击编辑按钮\r\n            $(\"#batch-edit-btn\").click(function(){\r\n                $(\".edit-btn\").click();\r\n            });\r\n            $(\"#batch-save-btn\").click(function(){\r\n                $(\".save-btn\").click();\r\n            });\r\n\r\n            //物品清单批量点击编辑按钮\r\n            $(\"#list-batch-edit-btn\").click(function(){\r\n                $(\".list-edit-btn\").click();\r\n            });\r\n            $(\"#list-batch-save-btn\").click(function(){\r\n                $(\".list-save-btn\").click();\r\n            });\r\n\r\n            // 申请单点击删除按钮，触发删除行脚本\r\n            $(document).on(\"click\",'.delete',function(){\r\n                $('#table').dataTable().fnDeleteRow($(this).closest('tr')[0]);\r\n            });\r\n            // 物品清单点击删除按钮，触发删除行脚本\r\n            $(document).on(\"click\",'.list-delete',function(){\r\n                $('#listTable').dataTable().fnDeleteRow($(this).closest('tr')[0]);\r\n            });\r\n\r\n            $(\"#table tbody tr\").each(function () {\r\n                var a = $(this).children();//获取每一行\r\n                var arr =a[6].innerText;//取得第六列的值\r\n                if(arr==='0'){\r\n                    a[6].innerText = '未提交';\r\n                }else if(arr==='1'){\r\n                    a[6].innerText = '已提交';\r\n                    a.find('.submit-btn').attr('disabled',true);\r\n                    a.find('.edit-btn').attr('disabled',true);\r\n                }else if(arr==='2'){\r\n                    a[6].innerText = '审核通过';\r\n                    a.find('.submit-btn').attr('disabled',true);\r\n                    a.find('.edit-btn').attr('disabled',true);\r\n                }else if(arr==='3'){\r\n                    a[6].innerText = '审核未通过';\r\n                }\r\n            })\r\n        });\r\n    });\r\n</script>\r\n\r\n<script>\r\n    function fnClickAddRow() {\r\n        $('#table').dataTable().fnAddData([\r\n            \"\", \"\", \"\", \"\",\r\n            \"\", \"\", \"未提交\", \"\", \"\",\r\n            \"\", \"\"]);}\r\n    function listfnClickAddRow() {\r\n        $('#listTable').dataTable().fnAddData([\r\n            \"\", \"\", \"\", \"\",\r\n            \"\", \"\", \"\", \"\", \"\",\r\n            \"\", \"\"]);}\r\n</script>\r\n\r\n</body>\r\n</html>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/webapp/form_waste.html b/src/main/webapp/form_waste.html
--- a/src/main/webapp/form_waste.html	(revision 855945133b8f01b67598a2f6ef2ea8348c09b16b)
+++ b/src/main/webapp/form_waste.html	(date 1686232908199)
@@ -175,36 +175,68 @@
     });
 </script>
 <script>
-    const dataSet = [
-        ['id', 'aaa', 'bb', '30', 'xxxx-xx','30', '1'],
-        ['id1', 'aaa1', 'cc', '20', 'xxxx-xx','30', '2'],
-        ['id2', 'aaa', 'bb', '30', 'xxxx-xx','30', '3'],
-        ['id3', 'aaa1', 'cc', '20', 'xxxx-xx','30', '0'],
-        ['id4', 'aaa', 'bb', '30', 'xxxx-xx','30', '1'],
-        ['id5', 'aaa1', 'cc', '20', 'xxxx-xx','30', '2'],
-        ['id6', 'aaa', 'bb', '30', 'xxxx-xx','30', '3'],
-        ['id7', 'aaa1', 'cc', '20', 'xxxx-xx','30', '0'],
-        ['id8', 'aaa', 'bb', '30', 'xxxx-xx','30', '3'],
-        ['id9', 'aaa1', 'cc', '20', 'xxxx-xx','30', '2'],
-    ];
-    const dataSets = [
-        ['aaa', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa1', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa2', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa3', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa4', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa5', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa6', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa7', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa8', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa9', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa10', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa11', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa12', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa13', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa14', '规格', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-        ['aaa15', '规格1', '20', '单位', 'fenlei', '10.0', 'xxxx-xx', '300', '20', '1hao', 'beizhu'],
-    ];
+    var temp_user_id;
+    var temp_data;
+
+    console.log("--flag-1-");
+
+    $.ajax({
+        async: false,
+        type : "post",
+        url : "user/findOne",
+        success : function(user) {
+            console.log("--flag-findOne-");
+            temp_user_id = user.user_id;
+            console.log("user.user_id"+user.user_id);
+        }
+    });
+
+    // 初始化，获取首页表格数据
+    $.ajax({
+        async: false,
+        data: {user_id: temp_user_id},
+        type : "post",
+        //等servlet
+        url : "purchase/initTable",
+        success : function(data) {
+            console.log("--flag-inittable-");
+            temp_data=data.data;
+        }
+    });
+
+    function json2Array(jsonData, list_or_not) {
+        var jsonsString = jsonData.slice(1, jsonData.length - 1);
+        var jsonStrings = jsonsString.split("},");
+        var length = jsonStrings.length;
+        var jsons = [];
+        for (var i = 0; i !== length-1; ++i) {
+            jsonStrings[i] += '}';
+        }
+        var source = [[]];
+        for (var i = 0; i !== length; ++i) {
+            //console.log("$"+jsonStrings[i]);
+            jsons[i] = eval('(' + jsonStrings[i] + ')');
+            var data = [];
+            for(var key in jsons[i]) {
+                if(i === 0) {
+                    source[0].push(key);
+                }
+                //console.log("i="+i+"|key="+key+"|json[i,key]="+jsons[i][key]);
+                if(!list_or_not || key !== "object_id" ) {
+                    data.push(jsons[i][key]);
+                } else {
+                    console.log("跳过在执行一次")
+                }
+            }
+            source.push(data);
+        }
+        return source.slice(1); //删除第1行
+    }
+    //console.log("temp_data=\n"+temp_data);
+    temp_data = json2Array(temp_data, false)
+
+    const dataSets = [];  //初始化物品清单数据源
+    //console.log("temp_data1=\n"+temp_data);
     $(document).ready(function() {
         $(function(){
             var table = $('#table').DataTable({
@@ -293,9 +325,57 @@
                 }
             });
 
+
+            var temp_list_data;
+            var temp_order_id;  // 本条订单的order——id
+
+            //点击物品清单
+            $("table tbody").on("click",".list-btn",function (){
+                // TODO: 待办 - 进入物品清单弹窗，刷新表单
+                //$('#listTable').dataTable().api().draw();
+
+                var tds=$(this).parents("tr").children();
+                temp_order_id = tds[1].innerText;
+                //console.log("temp_order_id"+temp_order_id);
+                $.ajax({
+                    async: true,  // true 同步，false异步
+                    data: {order_id: temp_order_id},
+                    type: "post",
+                    url : "purchase/initListTable",
+                    success : function(data) {
+                        //console.log("--flag-initListTable-");
+                        temp_list_data=data.data;
+                        temp_list_data = json2Array(temp_list_data, true)
+                    }
+                });
+
+                $('#updateModal').modal('show');  // 显示弹窗表格
+                // 更新表格数据
+                $('#listTable').dataTable().api().clear();
+                $('#listTable').dataTable().api().rows.add(temp_list_data);
+                $('#listTable').dataTable().api().draw();
+
+
+                var arr = tds[6].innerText;
+                console.log(arr);
+                if(arr==='已提交'||arr==='审核通过'){
+                    $('.list-edit-btn').attr('disabled',true);
+                    $('.list-delete').attr('disabled',true);
+                    $('.list-top-btn').attr('disabled',true);
+                }
+                if(arr==='未提交'||arr==='审核未通过'){
+                    $('.list-edit-btn').attr('disabled',false);
+                    $('.list-delete').attr('disabled',false);
+                    $('.list-top-btn').attr('disabled',false);
+                }
+
+                $('#updateModal').modal('show');
+            })
+
             var listtable = $('#listTable').DataTable({
                 retrieve: true,
                 data:dataSets,
+                //ajax: "json/PurchaseListData.txt",
                 columns:[
                     {
                         'field': "name",
@@ -316,8 +396,6 @@
                         'field': "unit",
                         'title': '包装单位',
                         'defaultContent' : "",
-
-
                         'sClass': 'text-center'
                     }, {
                         'field': "classification",
@@ -355,7 +433,7 @@
                         'field': "notes",
                         'title': '备注',
                         'defaultContent' : "",
-                        width:150,
+                        //width:150,
                         'sClass': 'text-center'
                     }, {
                         field: "operate",
@@ -399,26 +477,6 @@
                 }
             });
 
-            //点击物品清单
-            $("table tbody").on("click",".list-btn",function (){
-                // $('#listTable').dataTable().api().draw();
-                // $('#listTable').dataTable().reload();
-                var tds=$(this).parents("tr").children();
-                var arr = tds[6].innerText;
-                console.log(arr);
-                if(arr==='已提交'||arr==='审核通过'){
-                    $('.list-edit-btn').attr('disabled',true);
-                    $('.list-delete').attr('disabled',true);
-                    $('.list-top-btn').attr('disabled',true);
-                }
-                if(arr==='未提交'||arr==='审核未通过'){
-                    $('.list-edit-btn').attr('disabled',false);
-                    $('.list-delete').attr('disabled',false);
-                    $('.list-top-btn').attr('disabled',false);
-                }
-
-                $('#updateModal').modal('show');
-            })
 
             //点击提交按钮
             $("table tbody").on("click",".submit-btn",function (){
@@ -426,20 +484,71 @@
                 var arr = tds[6].innerText;
                 console.log(arr);
                 if(arr==='未提交'||arr==='审核未通过'){
-
                     //提交的代码
                     if(confirm('确认提交申请？')){
-                        //点击确认
-                        tds[6].innerText = '已提交';
-                        $(this).attr('disabled',true);
-                        tds.find('.edit-btn').attr('disabled',true);
-                    }else{
-                        //点击取消
-
-                    }
-
+                        // 拼后端BeanUtils所需的map串
+
+                        // 时间格式纠正
+                        Date.prototype.toLocaleString = function() {
+                            function addZero(num) {
+                                return num < 10 ? "0" + num : num;
+                            }
+                            // 按自定义拼接格式返回
+                            return this.getFullYear() + "/" + addZero(this.getMonth() + 1) + "/" + addZero(this.getDate()) + " " +
+                                addZero((this.getHours()+24-8)%24) + ":" + addZero(this.getMinutes()) + ":" + addZero(this.getSeconds());
+                        };
+                        var requisition_dateTime = "", approval_date = "";
+                        if (tds[5].innerText !== "")
+                            requisition_dateTime = (new Date(eval(tds[5].innerText))).toLocaleString();
+                        if (tds[9].innerText !== "")
+                            approval_date = (new Date(eval(tds[9].innerText))).toLocaleString();
+
+                        // 状态改回数值
+                        var shenqing_state = '';
+                        if(arr==='未提交'){
+                            shenqing_state = '0';
+                        }else if(arr==='已提交'){
+                            shenqing_state = '1';
+                        }else if(arr==='审核通过'){
+                            shenqing_state = '2';
+                        }else if(arr==='审核未通过'){
+                            shenqing_state = '3';
+                        }
+
+                        var front_end_data = "";
+                        if (tds[0].innerText !== "") front_end_data += "waste_requisition_id="+tds[0].innerText+"&";
+                        if (tds[1].innerText !== "") front_end_data += "waste_order_id="+tds[1].innerText+"&";
+                        if (tds[3].innerText !== "") front_end_data += "waste_reason="+tds[3].innerText+"&";
+                        if (tds[4].innerText !== "") front_end_data += "waste_position="+tds[4].innerText+"&";
+                        if (tds[5].innerText !== "") front_end_data += "requisition_date="+requisition_dateTime+"&";
+                        if (tds[6].innerText !== "") front_end_data += "&state="+shenqing_state+"&";
+                        if (tds[7].innerText !== "") front_end_data += "&approval_user_id="+tds[7].innerText+"&";
+                        if (tds[8].innerText !== "") front_end_data += "&approval_opinions="+tds[8].innerText+"&";
+                        if (tds[9].innerText !== "") front_end_data += "&approval_date="+approval_date+"&";
+                        // front_end_data = front_end_data.substring(0, front_end_data.length-1);  //删除最后一个字符
+
+                        $.get("user/findOne", {}, function (data) {
+                            // 获取当前登陆的用户id
+                            front_end_data += "requisition_user_id="+data.user_id;
+                            console.log("front_end_data="+front_end_data);
+                            // 把前端数据传给后端
+                            //等servlet
+                            $.post("purchase/createOrUpdateItems", front_end_data, function (data) {
+                                console.log("在接受后端数据之后");
+                                if (data.flag) {
+                                    alert("提交成功");
+                                    tds[6].innerText = '已提交';
+                                    // 禁用按钮：应该放入点击确认
+                                    $(this).attr('disabled',true);
+                                    tds.find('.edit-btn').attr('disabled',true);
+                                } else {
+                                    alert("提交失败");
+                                }
+                            })
+                        });  // end of $.get("user/findOne"...
+                    } // end of confirm(确认提交申请？)
+                    else{}//点击取消，无事发生
                 }
-
             })
 
             // 申请表修改
@@ -465,10 +574,10 @@
                 $.each(tds, function(i,val){
                     var jqob=$(val);
                     //把input变为字符串
-                    console.log(!jqob.has('button').length);
+                    //console.log(!jqob.has('button').length);
                     if(!jqob.has('button').length){
                         var txt=jqob.children("input").val();
-                        console.log(jqob.children("input"));
+                        //console.log(jqob.children("input"));
                         jqob.html(txt);
                         table.cell(jqob).data(txt);//修改DataTables对象的数据
                     }
@@ -499,16 +608,55 @@
                 var row=listtable.row($(this).parents("tr"));
                 var tds=$(this).parents("tr").children();
                 $.each(tds, function(i,val){
+                    console.log("|"+tds[i].innerText+"|");
                     var jqob=$(val);
                     //把input变为字符串
-                    console.log(!jqob.has('button').length);
+                    //console.log(!jqob.has('button').length);
                     if(!jqob.has('button').length){
                         var txt=jqob.children("input").val();
-                        console.log(jqob.children("input"));
+                        //console.log(jqob.children("input"));
                         jqob.html(txt);
                         listtable.cell(jqob).data(txt);//修改DataTables对象的数据
                     }
                 });
+
+                var front_end_data = "";
+                if (tds[0].innerText !== "") front_end_data += "name="+tds[0].innerText+"&";
+                if (tds[1].innerText !== "") front_end_data += "specification="+tds[1].innerText+"&";
+                if (tds[2].innerText !== "") front_end_data += "quantity="+tds[2].innerText+"&";
+                if (tds[3].innerText !== "") front_end_data += "unit="+tds[3].innerText+"&";
+                if (tds[4].innerText !== "") front_end_data += "classification="+tds[4].innerText+"&";
+                if (tds[5].innerText !== "") front_end_data += "price="+tds[5].innerText+"&";
+                if (tds[6].innerText !== "") front_end_data += "expiration_time="+tds[6].innerText+"&";
+                if (tds[7].innerText !== "") front_end_data += "upper_limit="+tds[7].innerText+"&";
+                if (tds[8].innerText !== "") front_end_data += "lower_limit="+tds[8].innerText+"&";
+                if (tds[9].innerText !== "") front_end_data += "warehouse_id="+tds[9].innerText+"&";
+                if (tds[10].innerText !== "") front_end_data += "notes="+tds[10].innerText+"&";
+
+                //front_end_data = front_end_data.substring(0, front_end_data.length-1);  //删除最后一个字符
+                console.log("front_end_data"+front_end_data)
+                $.get("user/findOne", {}, function (data) {
+                    // 获取当前登陆的用户id
+                    front_end_data += "requisition_user_id="+data.user_id;
+                    console.log("front_end_data="+front_end_data);
+                    // 把前端数据传给后端
+                    //等servlet
+                    $.post("purchase/getOrderId", {order_id: temp_order_id}, function () {
+                        $.post("purchase/UpdateItemsList", front_end_data, function (data) {
+                            console.log("在接受后端数据之后");
+                            if (data.flag) {
+                                alert("提交成功");
+                                // 禁用按钮：应该放入点击确认
+                                $(this).attr('disabled',true);
+                                tds.find('.edit-btn').attr('disabled',true);
+                            } else {
+                                alert("提交失败");
+                            }
+                        });
+                    });
+
+                });  // end of $.get("user/findOne"...
+
                 $(this).html("编辑");
                 $(this).toggleClass("list-edit-btn");
                 $(this).toggleClass("list-save-btn");
@@ -539,6 +687,7 @@
                 $('#listTable').dataTable().fnDeleteRow($(this).closest('tr')[0]);
             });
 
+            // 根据 申请当前状态的数值，设置前端表格的文字，以及对应行按钮是否可用
             $("#table tbody tr").each(function () {
                 var a = $(this).children();//获取每一行
                 var arr =a[6].innerText;//取得第六列的值
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"ArtifactsWorkspaceSettings\">\r\n    <artifacts-to-build>\r\n      <artifact name=\"travel:war\" />\r\n    </artifacts-to-build>\r\n  </component>\r\n  <component name=\"AutoImportSettings\">\r\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\r\n  </component>\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"4a6ee96f-f4a8-4e70-87f3-f76f4265a3ec\" name=\"Default Changelist\" comment=\"修正了DateTime时区的问题，前端可以获取当前用户登录信息\">\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Checkout_at_2023_6_2_21_37__Default_Changelist_.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Checkout_at_2023_6_2_21_37__Default_Changelist_.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/java/service/impl/purchase_requisition_service_impl.java\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/java/service/impl/purchase_requisition_service_impl.java\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/java/web/servlet/PurchaseServlet.java\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/java/web/servlet/PurchaseServlet.java\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/resources/druid.properties\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/resources/druid.properties\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/webapp/form_purchase.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/webapp/form_purchase.html\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/webapp/form_waste.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/webapp/form_waste.html\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/src/main/webapp/left_sidebar.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/src/main/webapp/left_sidebar.html\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"FileTemplateManagerImpl\">\r\n    <option name=\"RECENT_TEMPLATES\">\r\n      <list>\r\n        <option value=\"Class\" />\r\n        <option value=\"Interface\" />\r\n      </list>\r\n    </option>\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <excluded-from-favorite>\r\n      <branch-storage>\r\n        <map>\r\n          <entry type=\"REMOTE\">\r\n            <value>\r\n              <list>\r\n                <branch-info repo=\"$PROJECT_DIR$\" source=\"origin/master\" />\r\n              </list>\r\n            </value>\r\n          </entry>\r\n        </map>\r\n      </branch-storage>\r\n    </excluded-from-favorite>\r\n    <option name=\"RECENT_BRANCH_BY_REPOSITORY\">\r\n      <map>\r\n        <entry key=\"$PROJECT_DIR$\" value=\"master\" />\r\n      </map>\r\n    </option>\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"GitSEFilterConfiguration\">\r\n    <file-type-list>\r\n      <filtered-out-file-type name=\"LOCAL_BRANCH\" />\r\n      <filtered-out-file-type name=\"REMOTE_BRANCH\" />\r\n      <filtered-out-file-type name=\"TAG\" />\r\n      <filtered-out-file-type name=\"COMMIT_BY_MESSAGE\" />\r\n    </file-type-list>\r\n  </component>\r\n  <component name=\"LogFilters\">\r\n    <option name=\"FILTER_ERRORS\" value=\"false\" />\r\n    <option name=\"FILTER_WARNINGS\" value=\"false\" />\r\n    <option name=\"FILTER_INFO\" value=\"true\" />\r\n    <option name=\"FILTER_DEBUG\" value=\"true\" />\r\n    <option name=\"CUSTOM_FILTER\" />\r\n  </component>\r\n  <component name=\"MarkdownSettingsMigration\">\r\n    <option name=\"stateVersion\" value=\"1\" />\r\n  </component>\r\n  <component name=\"ProjectId\" id=\"2Avt6bIjEb9LPH0DVMOFNxUmr9z\" />\r\n  <component name=\"ProjectLevelVcsManager\" settingsEditedManually=\"true\">\r\n    <ConfirmationsSetting value=\"2\" id=\"Add\" />\r\n  </component>\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">\r\n    <property name=\"ASKED_ADD_EXTERNAL_FILES\" value=\"true\" />\r\n    <property name=\"RunOnceActivity.OpenProjectViewOnStart\" value=\"true\" />\r\n    <property name=\"RunOnceActivity.ShowReadmeOnStart\" value=\"true\" />\r\n    <property name=\"SHARE_PROJECT_CONFIGURATION_FILES\" value=\"true\" />\r\n    <property name=\"WebServerToolWindowFactoryState\" value=\"false\" />\r\n    <property name=\"aspect.path.notification.shown\" value=\"true\" />\r\n    <property name=\"last_opened_file_path\" value=\"$PROJECT_DIR$\" />\r\n    <property name=\"node.js.detected.package.eslint\" value=\"true\" />\r\n    <property name=\"node.js.path.for.package.eslint\" value=\"project\" />\r\n    <property name=\"node.js.path.for.package.tslint\" value=\"project\" />\r\n    <property name=\"node.js.selected.package.eslint\" value=\"(autodetect)\" />\r\n    <property name=\"node.js.selected.package.tslint\" value=\"(autodetect)\" />\r\n    <property name=\"nodejs_package_manager_path\" value=\"npm\" />\r\n    <property name=\"project.structure.last.edited\" value=\"Modules\" />\r\n    <property name=\"project.structure.proportion\" value=\"0.17\" />\r\n    <property name=\"project.structure.side.proportion\" value=\"0.26412776\" />\r\n    <property name=\"settings.editor.selected.configurable\" value=\"MavenSettings\" />\r\n  </component>\r\n  <component name=\"RecentsManager\">\r\n    <key name=\"CopyFile.RECENT_KEYS\">\r\n      <recent name=\"D:\\develop\\Java\\ChemicalLabItemMS\\src\\main\\webapp\" />\r\n      <recent name=\"D:\\develop\\Java\\ChemicalLabItemMS\\src\\main\\webapp\\front-end-res-lib\" />\r\n      <recent name=\"D:\\develop\\Java\\ChemicalLabItemMS\\src\\main\\java\\service\\temp_service\" />\r\n    </key>\r\n    <key name=\"MoveFile.RECENT_KEYS\">\r\n      <recent name=\"D:\\develop\\Java\\ChemicalLabItemMS\\src\\main\\webapp\\html_temp\" />\r\n    </key>\r\n    <key name=\"MoveClassesOrPackagesDialog.RECENTS_KEY\">\r\n      <recent name=\"\" />\r\n    </key>\r\n    <key name=\"CopyClassDialog.RECENTS_KEY\">\r\n      <recent name=\"web\" />\r\n    </key>\r\n  </component>\r\n  <component name=\"RunManager\" selected=\"Maven.ChemicalLabItemMS\">\r\n    <configuration default=\"true\" type=\"ArquillianJUnit\" factoryName=\"\" nameIsGenerated=\"true\">\r\n      <option name=\"arquillianRunConfiguration\">\r\n        <value>\r\n          <option name=\"containerStateName\" value=\"\" />\r\n        </value>\r\n      </option>\r\n      <option name=\"TEST_OBJECT\" value=\"class\" />\r\n      <method v=\"2\">\r\n        <option name=\"Make\" enabled=\"true\" />\r\n      </method>\r\n    </configuration>\r\n    <configuration name=\"ChemicalLabItemMS\" type=\"MavenRunConfiguration\" factoryName=\"Maven\">\r\n      <MavenSettings>\r\n        <option name=\"myGeneralSettings\" />\r\n        <option name=\"myRunnerSettings\" />\r\n        <option name=\"myRunnerParameters\">\r\n          <MavenRunnerParameters>\r\n            <option name=\"profiles\">\r\n              <set />\r\n            </option>\r\n            <option name=\"goals\">\r\n              <list>\r\n                <option value=\"tomcat7:run\" />\r\n              </list>\r\n            </option>\r\n            <option name=\"pomFileName\" />\r\n            <option name=\"profilesMap\">\r\n              <map />\r\n            </option>\r\n            <option name=\"resolveToWorkspace\" value=\"false\" />\r\n            <option name=\"workingDirPath\" value=\"$PROJECT_DIR$\" />\r\n          </MavenRunnerParameters>\r\n        </option>\r\n      </MavenSettings>\r\n      <method v=\"2\" />\r\n    </configuration>\r\n    <configuration name=\"Tomcat 8.5.24\" type=\"#com.intellij.j2ee.web.tomcat.TomcatRunConfigurationFactory\" factoryName=\"Local\" APPLICATION_SERVER_NAME=\"Tomcat 8.5.24\" ALTERNATIVE_JRE_ENABLED=\"false\" nameIsGenerated=\"true\">\r\n      <option name=\"UPDATING_POLICY\" value=\"restart-server\" />\r\n      <deployment>\r\n        <artifact name=\"travel:war\">\r\n          <settings>\r\n            <option name=\"CONTEXT_PATH\" value=\"/travel_war\" />\r\n          </settings>\r\n        </artifact>\r\n        <artifact name=\"ChemicalLabItemMS:war\">\r\n          <settings>\r\n            <option name=\"CONTEXT_PATH\" value=\"/ChemicalLabItemMS_war\" />\r\n          </settings>\r\n        </artifact>\r\n      </deployment>\r\n      <server-settings>\r\n        <option name=\"BASE_DIRECTORY_NAME\" value=\"0049ada1-20ae-4acc-ba0a-1e64ffc4502d\" />\r\n      </server-settings>\r\n      <predefined_log_file enabled=\"true\" id=\"Tomcat\" />\r\n      <predefined_log_file enabled=\"true\" id=\"Tomcat Catalina\" />\r\n      <predefined_log_file id=\"Tomcat Manager\" />\r\n      <predefined_log_file id=\"Tomcat Host Manager\" />\r\n      <predefined_log_file id=\"Tomcat Localhost Access\" />\r\n      <RunnerSettings RunnerId=\"Debug\">\r\n        <option name=\"DEBUG_PORT\" value=\"1237\" />\r\n      </RunnerSettings>\r\n      <ConfigurationWrapper VM_VAR=\"JAVA_OPTS\" RunnerId=\"Cover\">\r\n        <option name=\"USE_ENV_VARIABLES\" value=\"true\" />\r\n        <STARTUP>\r\n          <option name=\"USE_DEFAULT\" value=\"true\" />\r\n          <option name=\"SCRIPT\" value=\"\" />\r\n          <option name=\"VM_PARAMETERS\" value=\"\" />\r\n          <option name=\"PROGRAM_PARAMETERS\" value=\"\" />\r\n        </STARTUP>\r\n        <SHUTDOWN>\r\n          <option name=\"USE_DEFAULT\" value=\"true\" />\r\n          <option name=\"SCRIPT\" value=\"\" />\r\n          <option name=\"VM_PARAMETERS\" value=\"\" />\r\n          <option name=\"PROGRAM_PARAMETERS\" value=\"\" />\r\n        </SHUTDOWN>\r\n      </ConfigurationWrapper>\r\n      <ConfigurationWrapper VM_VAR=\"JAVA_OPTS\" RunnerId=\"Debug\">\r\n        <option name=\"USE_ENV_VARIABLES\" value=\"true\" />\r\n        <STARTUP>\r\n          <option name=\"USE_DEFAULT\" value=\"true\" />\r\n          <option name=\"SCRIPT\" value=\"\" />\r\n          <option name=\"VM_PARAMETERS\" value=\"\" />\r\n          <option name=\"PROGRAM_PARAMETERS\" value=\"\" />\r\n        </STARTUP>\r\n        <SHUTDOWN>\r\n          <option name=\"USE_DEFAULT\" value=\"true\" />\r\n          <option name=\"SCRIPT\" value=\"\" />\r\n          <option name=\"VM_PARAMETERS\" value=\"\" />\r\n          <option name=\"PROGRAM_PARAMETERS\" value=\"\" />\r\n        </SHUTDOWN>\r\n      </ConfigurationWrapper>\r\n      <ConfigurationWrapper VM_VAR=\"JAVA_OPTS\" RunnerId=\"Profile\">\r\n        <option name=\"USE_ENV_VARIABLES\" value=\"true\" />\r\n        <STARTUP>\r\n          <option name=\"USE_DEFAULT\" value=\"true\" />\r\n          <option name=\"SCRIPT\" value=\"\" />\r\n          <option name=\"VM_PARAMETERS\" value=\"\" />\r\n          <option name=\"PROGRAM_PARAMETERS\" value=\"\" />\r\n        </STARTUP>\r\n        <SHUTDOWN>\r\n          <option name=\"USE_DEFAULT\" value=\"true\" />\r\n          <option name=\"SCRIPT\" value=\"\" />\r\n          <option name=\"VM_PARAMETERS\" value=\"\" />\r\n          <option name=\"PROGRAM_PARAMETERS\" value=\"\" />\r\n        </SHUTDOWN>\r\n      </ConfigurationWrapper>\r\n      <ConfigurationWrapper VM_VAR=\"JAVA_OPTS\" RunnerId=\"Run\">\r\n        <option name=\"USE_ENV_VARIABLES\" value=\"true\" />\r\n        <STARTUP>\r\n          <option name=\"USE_DEFAULT\" value=\"true\" />\r\n          <option name=\"SCRIPT\" value=\"\" />\r\n          <option name=\"VM_PARAMETERS\" value=\"\" />\r\n          <option name=\"PROGRAM_PARAMETERS\" value=\"\" />\r\n        </STARTUP>\r\n        <SHUTDOWN>\r\n          <option name=\"USE_DEFAULT\" value=\"true\" />\r\n          <option name=\"SCRIPT\" value=\"\" />\r\n          <option name=\"VM_PARAMETERS\" value=\"\" />\r\n          <option name=\"PROGRAM_PARAMETERS\" value=\"\" />\r\n        </SHUTDOWN>\r\n      </ConfigurationWrapper>\r\n      <method v=\"2\">\r\n        <option name=\"Make\" enabled=\"true\" />\r\n        <option name=\"BuildArtifacts\" enabled=\"true\">\r\n          <artifact name=\"ChemicalLabItemMS:war\" />\r\n        </option>\r\n      </method>\r\n    </configuration>\r\n    <list>\r\n      <item itemvalue=\"Maven.ChemicalLabItemMS\" />\r\n      <item itemvalue=\"Tomcat Server.Tomcat 8.5.24\" />\r\n    </list>\r\n  </component>\r\n  <component name=\"SpellCheckerSettings\" RuntimeDictionaries=\"0\" Folders=\"0\" CustomDictionaries=\"0\" DefaultDictionary=\"application-level\" UseSingleDictionary=\"true\" transferred=\"true\" />\r\n  <component name=\"SvnConfiguration\">\r\n    <configuration />\r\n  </component>\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"4a6ee96f-f4a8-4e70-87f3-f76f4265a3ec\" name=\"Default Changelist\" comment=\"\" />\r\n      <created>1655901715645</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1655901715645</updated>\r\n      <workItem from=\"1655901717854\" duration=\"450000\" />\r\n      <workItem from=\"1685427151825\" duration=\"1535000\" />\r\n      <workItem from=\"1685428706026\" duration=\"124000\" />\r\n      <workItem from=\"1685428833294\" duration=\"826000\" />\r\n      <workItem from=\"1685520782760\" duration=\"706000\" />\r\n      <workItem from=\"1685537381059\" duration=\"1334000\" />\r\n      <workItem from=\"1685540296469\" duration=\"811000\" />\r\n      <workItem from=\"1685599640376\" duration=\"132000\" />\r\n      <workItem from=\"1685599807762\" duration=\"1261000\" />\r\n      <workItem from=\"1685603422754\" duration=\"49000\" />\r\n      <workItem from=\"1685603474267\" duration=\"10000\" />\r\n      <workItem from=\"1685603485940\" duration=\"6000\" />\r\n      <workItem from=\"1685603502462\" duration=\"2399000\" />\r\n      <workItem from=\"1685674025238\" duration=\"1608000\" />\r\n      <workItem from=\"1685771307743\" duration=\"402000\" />\r\n      <workItem from=\"1685771714405\" duration=\"5544000\" />\r\n      <workItem from=\"1685777299983\" duration=\"306000\" />\r\n      <workItem from=\"1685897456684\" duration=\"1052000\" />\r\n      <workItem from=\"1685924081606\" duration=\"921000\" />\r\n      <workItem from=\"1685965736717\" duration=\"8365000\" />\r\n      <workItem from=\"1686020823650\" duration=\"2271000\" />\r\n      <workItem from=\"1686097290341\" duration=\"1965000\" />\r\n      <workItem from=\"1686103535919\" duration=\"1125000\" />\r\n      <workItem from=\"1686122288404\" duration=\"2228000\" />\r\n      <workItem from=\"1686124548099\" duration=\"13105000\" />\r\n      <workItem from=\"1686186044285\" duration=\"1925000\" />\r\n    </task>\r\n    <task id=\"LOCAL-00001\" summary=\"添加GoodsService及其实现，实体类Date-&gt;String\">\r\n      <created>1655902015448</created>\r\n      <option name=\"number\" value=\"00001\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1655902015448</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00002\" summary=\"更新了实体类的注释\">\r\n      <created>1685776134712</created>\r\n      <option name=\"number\" value=\"00002\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00002\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1685776134712</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00003\" summary=\"更新了实体类的注释\">\r\n      <created>1685777451475</created>\r\n      <option name=\"number\" value=\"00003\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00003\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1685777451475</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00004\" summary=\"更新了领用&amp;借用申请表的校验\">\r\n      <created>1685955280415</created>\r\n      <option name=\"number\" value=\"00004\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00004\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1685955280415</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00005\" summary=\"更新采购、领用dao层功能\">\r\n      <created>1686015910191</created>\r\n      <option name=\"number\" value=\"00005\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00005\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1686015910191</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00006\" summary=\"更新采购入库功能\">\r\n      <created>1686040539807</created>\r\n      <option name=\"number\" value=\"00006\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00006\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1686040539807</updated>\r\n    </task>\r\n    <option name=\"localTasksCounter\" value=\"7\" />\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n  <component name=\"Vcs.Log.Tabs.Properties\">\r\n    <option name=\"TAB_STATES\">\r\n      <map>\r\n        <entry key=\"MAIN\">\r\n          <value>\r\n            <State />\r\n          </value>\r\n        </entry>\r\n      </map>\r\n    </option>\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <option name=\"ADD_EXTERNAL_FILES_SILENTLY\" value=\"true\" />\r\n    <MESSAGE value=\"添加GoodsService及其实现，实体类Date-&gt;String\" />\r\n    <MESSAGE value=\"更新了实体类的注释\" />\r\n    <MESSAGE value=\"更新了领用&amp;借用申请表的校验\" />\r\n    <MESSAGE value=\"更新采购、领用dao层功能\" />\r\n    <MESSAGE value=\"更新废弃物后端\" />\r\n    <MESSAGE value=\"更新 借用入库 功能\" />\r\n    <MESSAGE value=\"完善了前端申请表、入库表的页面，实现采购申请的数据部分插入\" />\r\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"完善了前端申请表、入库表的页面，实现采购申请的数据部分插入\" />\r\n  </component>\r\n  <component name=\"XDebuggerManager\">\r\n    <breakpoint-manager>\r\n      <breakpoints>\r\n        <breakpoint enabled=\"true\" type=\"java-exception\">\r\n          <properties class=\"java.lang.NullPointerException\" package=\"java.lang\" />\r\n          <option name=\"timeStamp\" value=\"1\" />\r\n        </breakpoint>\r\n      </breakpoints>\r\n    </breakpoint-manager>\r\n  </component>\r\n  <component name=\"XSLT-Support.FileAssociations.UIState\">\r\n    <expand />\r\n    <select />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision 855945133b8f01b67598a2f6ef2ea8348c09b16b)
+++ b/.idea/workspace.xml	(date 1686232924398)
@@ -9,15 +9,10 @@
     <option name="autoReloadType" value="SELECTIVE" />
   </component>
   <component name="ChangeListManager">
-    <list default="true" id="4a6ee96f-f4a8-4e70-87f3-f76f4265a3ec" name="Default Changelist" comment="修正了DateTime时区的问题，前端可以获取当前用户登录信息">
-      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Checkout_at_2023_6_2_21_37__Default_Changelist_.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Checkout_at_2023_6_2_21_37__Default_Changelist_.xml" afterDir="false" />
+    <list default="true" id="4a6ee96f-f4a8-4e70-87f3-f76f4265a3ec" name="Default Changelist" comment="purchase更新新建功能">
       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/src/main/java/service/impl/purchase_requisition_service_impl.java" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/java/service/impl/purchase_requisition_service_impl.java" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/src/main/java/web/servlet/PurchaseServlet.java" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/java/web/servlet/PurchaseServlet.java" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/src/main/resources/druid.properties" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/resources/druid.properties" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/src/main/webapp/form_purchase.html" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/webapp/form_purchase.html" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/src/main/webapp/form_waste.html" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/webapp/form_waste.html" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/src/main/webapp/left_sidebar.html" beforeDir="false" afterPath="$PROJECT_DIR$/src/main/webapp/left_sidebar.html" afterDir="false" />
     </list>
     <option name="SHOW_DIALOG" value="false" />
     <option name="HIGHLIGHT_CONFLICTS" value="true" />
@@ -284,6 +279,8 @@
       <workItem from="1686122288404" duration="2228000" />
       <workItem from="1686124548099" duration="13105000" />
       <workItem from="1686186044285" duration="1925000" />
+      <workItem from="1686228544156" duration="194000" />
+      <workItem from="1686228753940" duration="4141000" />
     </task>
     <task id="LOCAL-00001" summary="添加GoodsService及其实现，实体类Date-&gt;String">
       <created>1655902015448</created>
@@ -327,7 +324,14 @@
       <option name="project" value="LOCAL" />
       <updated>1686040539807</updated>
     </task>
-    <option name="localTasksCounter" value="7" />
+    <task id="LOCAL-00007" summary="purchase更新新建功能">
+      <created>1686228336654</created>
+      <option name="number" value="00007" />
+      <option name="presentableId" value="LOCAL-00007" />
+      <option name="project" value="LOCAL" />
+      <updated>1686228336654</updated>
+    </task>
+    <option name="localTasksCounter" value="8" />
     <servers />
   </component>
   <component name="TypeScriptGeneratedFilesManager">
@@ -353,7 +357,8 @@
     <MESSAGE value="更新废弃物后端" />
     <MESSAGE value="更新 借用入库 功能" />
     <MESSAGE value="完善了前端申请表、入库表的页面，实现采购申请的数据部分插入" />
-    <option name="LAST_COMMIT_MESSAGE" value="完善了前端申请表、入库表的页面，实现采购申请的数据部分插入" />
+    <MESSAGE value="purchase更新新建功能" />
+    <option name="LAST_COMMIT_MESSAGE" value="purchase更新新建功能" />
   </component>
   <component name="XDebuggerManager">
     <breakpoint-manager>
Index: src/main/webapp/form_purchase.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><meta name=\"renderer\" content=\"webkit\">\r\n\r\n    <title>采购申请</title>\r\n    <meta name=\"keywords\" >\r\n    <meta name=\"description\" >\r\n    <link href=\"css/bootstrap.min.css?v=3.4.0\" rel=\"stylesheet\">\r\n    <link href=\"font-awesome/css/font-awesome.css?v=4.3.0\" rel=\"stylesheet\">\r\n    <link href=\"css/plugins/iCheck/custom.css\" rel=\"stylesheet\">\r\n    <link href=\"css/animate.css\" rel=\"stylesheet\">\r\n    <link href=\"css/style.css?v=2.2.0\" rel=\"stylesheet\">\r\n</head>\r\n<body>\r\n<!--<button type=\"button\" id=\"batch-edit-btn\">批量编辑</button>-->\r\n<!--<button type=\"button\" id=\"batch-save-btn\">批量保存</button>-->\r\n<!--<table id=\"table\" class=\"display\" width=\"100%\"></table>-->\r\n<div id=\"wrapper\">\r\n    <!-- 侧边栏 -->\r\n    <div id=\"left_sidebar\"></div>\r\n\r\n    <div id=\"page-wrapper\" class=\"gray-bg dashbard-1\">\r\n        <!--头部-->\r\n        <div id=\"header\"></div>\r\n        <div class=\"row wrapper border-bottom white-bg page-heading\">\r\n            <div class=\"col-lg-10\">\r\n                <h2>采购申请</h2>\r\n            </div>\r\n            <div class=\"col-lg-2\"></div>\r\n        </div>\r\n        <div class=\"wrapper wrapper-content animated fadeInRight\">\r\n            <!--                所有表单元素  -->\r\n            <div class=\"row\">\r\n                <div class=\"col-lg-12\">\r\n                    <div class=\"ibox float-e-margins\">\r\n                        <div class=\"ibox-title\">\r\n                            <h5>采购申请表</h5>\r\n                            <div class=\"ibox-tools\">\r\n                                <a class=\"collapse-link\">\r\n                                    <i class=\"fa fa-chevron-up\"></i>\r\n                                </a>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"ibox-content\">\r\n                            <form method=\"get\" class=\"form-horizontal\">\r\n\r\n                                <div class=\"row\">\r\n                                    <div class=\"col-lg-12\">\r\n                                        <div class=\"ibox float-e-margins\">\r\n\r\n                                            <div class=\"ibox-content\">\r\n                                                <div class=\"\">\r\n                                                    <a onclick=\"fnClickAddRow();\" href=\"javascript:void(0);\" class=\"btn btn-primary \">新建采购申请</a>\r\n                                                    <button type=\"button\" id=\"batch-edit-btn\" class=\"btn btn-primary \">批量编辑</button>\r\n                                                    <button type=\"button\" id=\"batch-save-btn\" class=\"btn btn-primary \">批量保存</button>\r\n                                                </div>\r\n\r\n\r\n                                                <table id=\"table\" class=\"datatable table table-striped table-bordered table-hover\">\r\n\r\n                                                </table>\r\n\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </form>\r\n                        </div>\r\n\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- 数据表单弹窗 -->\r\n        <form method=\"post\" class=\"form-horizontal\" role=\"form\" id=\"updateGoodsForm\">\r\n            <div class=\"modal fade\" id=\"updateModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"updateModalLabel\" aria-hidden=\"true\">\r\n                <div class=\"modal-dialog\" style=\"width: 1400px\">\r\n                    <div class=\"modal-content\">\r\n                        <div class=\"modal-header\">\r\n                            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">\r\n                                ×\r\n                            </button>\r\n                            <h4 class=\"modal-title\" id=\"updateModalLabel\">\r\n                                物品清单\r\n                            </h4>\r\n                        </div>\r\n\r\n                        <div class=\"form-group\">\r\n                            <div class=\"row\">\r\n                                <div class=\"col-lg-12\">\r\n                                    <div class=\"ibox float-e-margins\">\r\n                                        <div class=\"ibox-content\">\r\n\r\n                                            <div class=\"\">\r\n                                                <button onclick=\"listfnClickAddRow();\" href=\"javascript:void(0);\" class=\"list-top-btn btn btn-primary \">添加物品</button>\r\n                                                <button type=\"button\" id=\"list-batch-edit-btn\" class=\"list-top-btn btn btn-primary \">批量编辑</button>\r\n                                                <button type=\"button\" id=\"list-batch-save-btn\" class=\"list-top-btn btn btn-primary \">批量保存</button>\r\n                                            </div>\r\n\r\n                                            <table id=listTable width=\"100%\" class=\"table table-striped table-bordered table-hover dataTables-example\">\r\n\r\n                                            </table>\r\n\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>  <!--   end modal-body  -->\r\n                </div><!-- /.modal-content -->\r\n            </div><!-- /.modal -->\r\n        </form>\r\n    </div>\r\n</div>\r\n\r\n\r\n\r\n\r\n<!-- Mainly scripts -->\r\n<script src=\"js/jquery-2.1.1.min.js\"></script>\r\n<script src=\"js/bootstrap.min.js?v=3.4.0\"></script>\r\n<script src=\"js/plugins/metisMenu/jquery.metisMenu.js\"></script>\r\n<script src=\"js/plugins/slimscroll/jquery.slimscroll.min.js\"></script>\r\n\r\n<!-- Custom and plugin javascript -->\r\n<script src=\"js/hplus.js?v=2.2.0\"></script>\r\n<script src=\"js/plugins/pace/pace.min.js\"></script>\r\n\r\n<!-- iCheck -->\r\n<script src=\"js/plugins/iCheck/icheck.min.js\"></script>\r\n\r\n<!--&lt;!&ndash;引入JavaScript&ndash;&gt;-->\r\n<script type=\"text/javascript\" language=\"javascript\" src=\"https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js\"></script>\r\n\r\n\r\n<!-- Data Tables -->\r\n<script src=\"js/plugins/dataTables/jquery.dataTables.js\"></script>\r\n<script s’‘rc=\"js/plugins/dataTables/dataTables.bootstrap.js\"></script>\r\n\r\n<!--&lt;!&ndash;引入css&ndash;&gt;-->\r\n<!--<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css\">-->\r\n\r\n<!--&lt;!&ndash;&lt;!&ndash;引入JavaScript&ndash;&gt;&ndash;&gt;-->\r\n<!--<script type=\"text/javascript\" language=\"javascript\" src=\"//code.jquery.com/jquery-1.12.4.js\"></script>-->\r\n<!--<script type=\"text/javascript\" language=\"javascript\" src=\"https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js\"></script>-->\r\n\r\n\r\n\r\n<!--初始化代码-->\r\n<!-- 导入header -->\r\n<script>\r\n    $(function () {\r\n        $.get(\"header.html\",function (data) {\r\n            $(\"#header\").html(data);\r\n        });\r\n    });\r\n</script>\r\n<script>\r\n    $(function () {\r\n        $.get(\"left_sidebar.html\",function (data) {\r\n            $(\"#left_sidebar\").html(data);\r\n        });\r\n    });\r\n</script>\r\n<script>\r\n    var temp_user_id;\r\n    var temp_data;\r\n\r\n    console.log(\"--flag-1-\");\r\n\r\n    $.ajax({\r\n        async: false,\r\n        type : \"post\",\r\n        url : \"user/findOne\",\r\n        success : function(user) {\r\n            console.log(\"--flag-findOne-\");\r\n            temp_user_id = user.user_id;\r\n            console.log(\"user.user_id\"+user.user_id);\r\n        }\r\n    });\r\n    // 初始化，获取首页表格数据\r\n    $.ajax({\r\n        async: false,\r\n        data: {user_id: temp_user_id},\r\n        type : \"post\",\r\n        url : \"purchase/initTable\",\r\n        success : function(data) {\r\n            console.log(\"--flag-inittable-\");\r\n            temp_data=data.data;\r\n        }\r\n    });\r\n\r\n    function json2Array(jsonData, list_or_not) {\r\n        var jsonsString = jsonData.slice(1, jsonData.length - 1);\r\n        var jsonStrings = jsonsString.split(\"},\");\r\n        var length = jsonStrings.length;\r\n        var jsons = [];\r\n        for (var i = 0; i !== length-1; ++i) {\r\n            jsonStrings[i] += '}';\r\n        }\r\n        var source = [[]];\r\n        for (var i = 0; i !== length; ++i) {\r\n            //console.log(\"$\"+jsonStrings[i]);\r\n            jsons[i] = eval('(' + jsonStrings[i] + ')');\r\n            var data = [];\r\n            for(var key in jsons[i]) {\r\n                if(i === 0) {\r\n                    source[0].push(key);\r\n                }\r\n                //console.log(\"i=\"+i+\"|key=\"+key+\"|json[i,key]=\"+jsons[i][key]);\r\n                if(!list_or_not || key !== \"object_id\" ) {\r\n                    data.push(jsons[i][key]);\r\n                } else {\r\n                    console.log(\"跳过在执行一次\")\r\n                }\r\n            }\r\n            source.push(data);\r\n        }\r\n        return source.slice(1); //删除第1行\r\n    }\r\n    //console.log(\"temp_data=\\n\"+temp_data);\r\n    temp_data = json2Array(temp_data, false)\r\n\r\n    const dataSets = [];  //初始化物品清单数据源\r\n    //console.log(\"temp_data1=\\n\"+temp_data);\r\n    $(document).ready(function() {\r\n        $(function(){\r\n            var table = $('#table').DataTable({\r\n                retrieve: true,\r\n                data:temp_data,\r\n                columns:[\r\n                    {\r\n                        'field': \"purchase_requisition_id\",\r\n                        'title': '采购申请表编号',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"purchase_order_id\",\r\n                        'title': '采购物品清单编号',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"requisition_user_id\",\r\n                        'title': '申请人',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"purpose\",\r\n                        'title': '采购用途',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"requisition_date\",\r\n                        'title': '申请提交日期',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"state\",\r\n                        'title': '申请当前状态',\r\n                        'defaultContent' : \"0\"\r\n                    }, {\r\n                        'field': \"approval_user_id\",\r\n                        'title': '审批人',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"approval_opinions\",\r\n                        'title': '审批意见',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        'field': \"approval_date\",\r\n                        'title': '审批日期',\r\n                        'defaultContent' : \"\"\r\n                    }, {\r\n                        field: \"operate\",\r\n                        sTitle: '操作',\r\n                        sDefaultContent : \"<button class='submit-btn btn btn-primary btn-xs' type='button' >提交</button>\"+\r\n                            \"<button class='edit-btn btn btn-primary btn-xs' type='button' style='margin-left: 10px'>编辑</button>\"  +\r\n                        \"<button class='list-btn btn btn-primary btn-xs' type='button' style='margin-left: 10px'>物品清单</button>\"+\r\n                            \"<button class='delete btn btn-default btn-xs' style='margin-left: 10px'>删除</button>\",\r\n                        sClass: 'text-center',\r\n                        \"data\" : null,\r\n                        // \"render\" : function(data, type,row) {\r\n                        //     var id = '\"' + row.id + '\"';\r\n                        //     var html = \"<a href='javascript:void(0);'  class='btn btn-primary btn-xs'  onclick='EditViewById()'></i>物品清单</a>\"\r\n                        //     return html;\r\n                        //     // formatter: actionFormatter\r\n                        // }\r\n                    }],\r\n                \"language\": {\r\n                    \"sProcessing\": \"处理中...\",\r\n                    \"sLengthMenu\": \"显示 _MENU_ 项结果\",\r\n                    \"sZeroRecords\": \"没有匹配结果\",\r\n                    \"sInfo\": \"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项\",\r\n                    \"sInfoEmpty\": \"显示第 0 至 0 项结果，共 0 项\",\r\n                    \"sInfoFiltered\": \"(由 _MAX_ 项结果过滤)\",\r\n                    \"sInfoPostFix\": \"\",\r\n                    \"sSearch\": \"搜索:\",\r\n                    \"sUrl\": \"\",\r\n                    \"sEmptyTable\": \"表中数据为空\",\r\n                    \"sLoadingRecords\": \"载入中...\",\r\n                    \"sInfoThousands\": \",\",\r\n                    \"oPaginate\": {\r\n                        \"sFirst\": \"首页\",\r\n                        \"sPrevious\": \"上页\",\r\n                        \"sNext\": \"下页\",\r\n                        \"sLast\": \"末页\"\r\n                    },\r\n                    \"oAria\": {\r\n                        \"sSortAscending\": \": 以升序排列此列\",\r\n                        \"sSortDescending\": \": 以降序排列此列\"\r\n                    }\r\n                }\r\n            });\r\n\r\n            var temp_list_data;\r\n            var temp_order_id;  // 本条订单的order——id\r\n\r\n            // 点击 物品清单\r\n            $(\"table tbody\").on(\"click\",\".list-btn\",function (){\r\n                // TODO: 待办 - 进入物品清单弹窗，刷新表单\r\n                //$('#listTable').dataTable().api().draw();\r\n\r\n                var tds=$(this).parents(\"tr\").children();\r\n                temp_order_id = tds[1].innerText;\r\n                //console.log(\"temp_order_id\"+temp_order_id);\r\n                $.ajax({\r\n                    async: true,  // true 同步，false异步\r\n                    data: {order_id: temp_order_id},\r\n                    type: \"post\",\r\n                    url : \"purchase/initListTable\",\r\n                    success : function(data) {\r\n                        //console.log(\"--flag-initListTable-\");\r\n                        temp_list_data=data.data;\r\n                        temp_list_data = json2Array(temp_list_data, true)\r\n                    }\r\n                });\r\n\r\n                $('#updateModal').modal('show');  // 显示弹窗表格\r\n                // 更新表格数据\r\n                $('#listTable').dataTable().api().clear();\r\n                $('#listTable').dataTable().api().rows.add(temp_list_data);\r\n                $('#listTable').dataTable().api().draw();\r\n\r\n\r\n                var arr = tds[5].innerText;\r\n                console.log(arr);\r\n                if(arr==='已提交'||arr==='审核通过'){\r\n                    $('.list-edit-btn').attr('disabled',true);\r\n                    $('.list-delete').attr('disabled',true);\r\n                    $('.list-top-btn').attr('disabled',true);\r\n                }\r\n                if(arr==='未提交'||arr==='审核未通过'){\r\n                    $('.list-edit-btn').attr('disabled',false);\r\n                    $('.list-delete').attr('disabled',false);\r\n                    $('.list-top-btn').attr('disabled',false);\r\n                }\r\n\r\n                $('#updateModal').modal('show');\r\n            })\r\n\r\n            var listtable = $('#listTable').DataTable({\r\n                retrieve: true,\r\n                data:dataSets,\r\n                //ajax: \"json/PurchaseListData.txt\",\r\n                columns:[\r\n                    {\r\n                        'field': \"name\",\r\n                        'title': '物品名称',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"specification\",\r\n                        'title': '规格',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"quantity\",\r\n                        'title': '数量',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"unit\",\r\n                        'title': '包装单位',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"classification\",\r\n                        'title': '分类',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"price\",\r\n                        'title': '单价',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"expiration_time\",\r\n                        'title': '过期时间',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"upper_limit\",\r\n                        'title': '警戒上限',\r\n                        // width:90,\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"lower_limit\",\r\n                        'title': '警戒下限',\r\n                        // width:90,\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        'field': \"notes\",\r\n                        'title': '备注',\r\n                        'defaultContent' : \"\",\r\n                        'sClass': 'text-center'\r\n                    }, {\r\n                        field: \"operate\",\r\n                        sTitle: '操作',\r\n                        sDefaultContent : \"<button class='list-edit-btn btn btn-primary btn-xs' type='button'>编辑</button>\" +\r\n                            \"<button class='list-delete btn btn-default btn-xs' style='margin-left: 10px'>删除</button>\",\r\n                        sClass: 'text-center',\r\n                        // width:100,\r\n                        \"data\" : null,\r\n                        // \"render\" : function(data, type,row) {\r\n                        //   var html = \"<a href='javascript:void(0);'  class='edit-btn btn btn-primary btn-xs' type='button'>修改</a>\"\r\n                        //   html += \"<a href='javascript:void(0);'  class='delete btn btn-default btn-xs'>删除</a>\"\r\n                        //   return html;\r\n                        //   // formatter: actionFormatter\r\n                        // }\r\n                    }],\r\n                \"language\": {\r\n                    \"sProcessing\": \"处理中...\",\r\n                    \"sLengthMenu\": \"显示 _MENU_ 项结果\",\r\n                    \"sZeroRecords\": \"没有匹配结果\",\r\n                    \"sInfo\": \"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项\",\r\n                    \"sInfoEmpty\": \"显示第 0 至 0 项结果，共 0 项\",\r\n                    \"sInfoFiltered\": \"(由 _MAX_ 项结果过滤)\",\r\n                    \"sInfoPostFix\": \"\",\r\n                    \"sSearch\": \"搜索:\",\r\n                    \"sUrl\": \"\",\r\n                    \"sEmptyTable\": \"表中数据为空\",\r\n                    \"sLoadingRecords\": \"载入中...\",\r\n                    \"sInfoThousands\": \",\",\r\n                    \"oPaginate\": {\r\n                        \"sFirst\": \"首页\",\r\n                        \"sPrevious\": \"上页\",\r\n                        \"sNext\": \"下页\",\r\n                        \"sLast\": \"末页\"\r\n                    },\r\n                    \"oAria\": {\r\n                        \"sSortAscending\": \": 以升序排列此列\",\r\n                        \"sSortDescending\": \": 以降序排列此列\"\r\n                    }\r\n                }\r\n            });\r\n\r\n\r\n            // 点击 提交 按钮\r\n            $(\"table tbody\").on(\"click\",\".submit-btn\",function (){\r\n                var tds=$(this).parents(\"tr\").children();\r\n                var arr = tds[5].innerText;\r\n                console.log(arr);\r\n                if(arr==='未提交'||arr==='审核未通过'){\r\n                    // 提交的代码\r\n                    if(confirm('确认提交申请？')){  //确认提交\r\n                        // 拼后端BeanUtils所需的map串\r\n\r\n                        // 时间格式纠正\r\n                        Date.prototype.toLocaleString = function() {\r\n                            function addZero(num) {\r\n                                return num < 10 ? \"0\" + num : num;\r\n                            }\r\n                            // 按自定义拼接格式返回\r\n                            return this.getFullYear() + \"/\" + addZero(this.getMonth() + 1) + \"/\" + addZero(this.getDate()) + \" \" +\r\n                                addZero((this.getHours()+24-8)%24) + \":\" + addZero(this.getMinutes()) + \":\" + addZero(this.getSeconds());\r\n                        };\r\n                        var requisition_dateTime = \"\", approval_date = \"\";\r\n                        if (tds[4].innerText !== \"\")\r\n                            requisition_dateTime = (new Date(eval(tds[4].innerText))).toLocaleString();\r\n                        if (tds[8].innerText !== \"\")\r\n                            approval_date = (new Date(eval(tds[8].innerText))).toLocaleString();\r\n\r\n                        // 状态改回数值\r\n                        var shenqing_state = '';\r\n                        if(arr==='未提交'){\r\n                            shenqing_state = '0';\r\n                        }else if(arr==='已提交'){\r\n                            shenqing_state = '1';\r\n                        }else if(arr==='审核通过'){\r\n                            shenqing_state = '2';\r\n                        }else if(arr==='审核未通过'){\r\n                            shenqing_state = '3';\r\n                        }\r\n\r\n                        var front_end_data = \"\";\r\n                        if (tds[0].innerText !== \"\") front_end_data += \"purchase_requisition_id=\"+tds[0].innerText+\"&\";\r\n                        if (tds[1].innerText !== \"\") front_end_data += \"purchase_order_id=\"+tds[1].innerText+\"&\";\r\n                        if (tds[3].innerText !== \"\") front_end_data += \"purpose=\"+tds[3].innerText+\"&\";\r\n                        if (tds[4].innerText !== \"\") front_end_data += \"requisition_date=\"+requisition_dateTime+\"&\";\r\n                        if (tds[5].innerText !== \"\") front_end_data += \"&state=\"+shenqing_state+\"&\";\r\n                        if (tds[6].innerText !== \"\") front_end_data += \"&approval_user_id=\"+tds[6].innerText+\"&\";\r\n                        if (tds[7].innerText !== \"\") front_end_data += \"&approval_opinions=\"+tds[7].innerText+\"&\";\r\n                        if (tds[8].innerText !== \"\") front_end_data += \"&approval_date=\"+approval_date+\"&\";\r\n                        // front_end_data = front_end_data.substring(0, front_end_data.length-1);  //删除最后一个字符\r\n\r\n                        $.get(\"user/findOne\", {}, function (data) {\r\n                            // 获取当前登陆的用户id\r\n                            front_end_data += \"requisition_user_id=\"+data.user_id;\r\n                            console.log(\"front_end_data=\"+front_end_data);\r\n                            // 把前端数据传给后端\r\n                            $.post(\"purchase/createOrUpdateItems\", front_end_data, function (data) {\r\n                                console.log(\"在接受后端数据之后\");\r\n                                if (data.flag) {\r\n                                    alert(\"提交成功\");\r\n                                    tds[5].innerText = '已提交';\r\n                                    // 禁用按钮：应该放入点击确认\r\n                                    $(this).attr('disabled',true);\r\n                                    tds.find('.edit-btn').attr('disabled',true);\r\n                                } else {\r\n                                    alert(\"提交失败\");\r\n                                }\r\n                            })\r\n                        });  // end of $.get(\"user/findOne\"...\r\n                    } // end of confirm(确认提交申请？)\r\n                    else {} //点击取消，无事发生\r\n                }\r\n            })\r\n\r\n            // 申请表修改\r\n            $(\"#table tbody\").on(\"click\",\".edit-btn\",function(){\r\n                var tds=$(this).parents(\"tr\").children();\r\n                $.each(tds, function(i,val){\r\n                    var jqob=$(val);\r\n                    if(i<=2||i>3 ){return true;}//跳过第1项 序号,按钮\r\n                    var txt=jqob.text();\r\n                    var put=$(\"<input type='text' style='width: 80px'>\");\r\n                    put.val(txt);\r\n                    jqob.html(put);\r\n                });\r\n                $(this).html(\"保存\");\r\n                $(this).toggleClass(\"edit-btn\");\r\n                $(this).toggleClass(\"save-btn\");\r\n            });\r\n\r\n            // 申请表修改保存\r\n            $(\"#table tbody\").on(\"click\",\".save-btn\",function(){\r\n                var row=table.row($(this).parents(\"tr\"));\r\n                var tds=$(this).parents(\"tr\").children();\r\n                $.each(tds, function(i,val){\r\n                    var jqob=$(val);\r\n                    //把input变为字符串\r\n                    //console.log(!jqob.has('button').length);\r\n                    if(!jqob.has('button').length){\r\n                        var txt=jqob.children(\"input\").val();\r\n                        //console.log(jqob.children(\"input\"));\r\n                        jqob.html(txt);\r\n                        table.cell(jqob).data(txt);//修改DataTables对象的数据\r\n                    }\r\n                });\r\n                $(this).html(\"编辑\");\r\n                $(this).toggleClass(\"edit-btn\");\r\n                $(this).toggleClass(\"save-btn\");\r\n            });\r\n\r\n            // 物品清单修改\r\n            $(\"#listTable tbody\").on(\"click\",\".list-edit-btn\",function(){\r\n                var tds=$(this).parents(\"tr\").children();\r\n                $.each(tds, function(i,val){\r\n                    var jqob=$(val);\r\n                    if(jqob.has('button').length ){return true;}//跳过第1项 序号,按钮\r\n                    var txt=jqob.text();\r\n                    var put=$(\"<input type='text' style='width: 80px'>\");\r\n                    put.val(txt);\r\n                    jqob.html(put);\r\n                });\r\n                $(this).html(\"保存\");\r\n                $(this).toggleClass(\"list-edit-btn\");\r\n                $(this).toggleClass(\"list-save-btn\");\r\n            });\r\n\r\n            //  物品清单修改保存\r\n            $(\"#listTable tbody\").on(\"click\",\".list-save-btn\",function(){\r\n                var row=listtable.row($(this).parents(\"tr\"));\r\n                var tds=$(this).parents(\"tr\").children();\r\n                $.each(tds, function(i,val){\r\n                    console.log(\"|\"+tds[i].innerText+\"|\");\r\n                    var jqob=$(val);\r\n                    //把input变为字符串\r\n                    if(!jqob.has('button').length){\r\n                        var txt=jqob.children(\"input\").val();\r\n                        jqob.html(txt);\r\n                        listtable.cell(jqob).data(txt);//修改DataTables对象的数据\r\n                    }\r\n                });\r\n\r\n                var front_end_data = \"\";\r\n                if (tds[0].innerText !== \"\") front_end_data += \"name=\"+tds[0].innerText+\"&\";\r\n                if (tds[1].innerText !== \"\") front_end_data += \"specification=\"+tds[1].innerText+\"&\";\r\n                if (tds[2].innerText !== \"\") front_end_data += \"quantity=\"+tds[2].innerText+\"&\";\r\n                if (tds[3].innerText !== \"\") front_end_data += \"unit=\"+tds[3].innerText+\"&\";\r\n                if (tds[4].innerText !== \"\") front_end_data += \"classification=\"+tds[4].innerText+\"&\";\r\n                if (tds[5].innerText !== \"\") front_end_data += \"price=\"+tds[5].innerText+\"&\";\r\n                if (tds[6].innerText !== \"\") front_end_data += \"expiration_time=\"+tds[6].innerText+\"&\";\r\n                if (tds[7].innerText !== \"\") front_end_data += \"lower_limit=\"+tds[7].innerText+\"&\";\r\n                if (tds[8].innerText !== \"\") front_end_data += \"upper_limit=\"+tds[8].innerText+\"&\";\r\n                if (tds[9].innerText !== \"\") front_end_data += \"notes=\"+tds[9].innerText+\"&\";\r\n                //front_end_data = front_end_data.substring(0, front_end_data.length-1);  //删除最后一个字符\r\n                console.log(\"front_end_data\"+front_end_data)\r\n                $.get(\"user/findOne\", {}, function (data) {\r\n                    // 获取当前登陆的用户id\r\n                    front_end_data += \"requisition_user_id=\"+data.user_id;\r\n                    console.log(\"front_end_data=\"+front_end_data);\r\n                    // 把前端数据传给后端\r\n                    $.post(\"purchase/getOrderId\", {order_id: temp_order_id}, function () {\r\n                        $.post(\"purchase/UpdateItemsList\", front_end_data, function (data) {\r\n                            console.log(\"在接受后端数据之后\");\r\n                            if (data.flag) {\r\n                                alert(\"提交成功\");\r\n                                // 禁用按钮：应该放入点击确认\r\n                                $(this).attr('disabled',true);\r\n                                tds.find('.edit-btn').attr('disabled',true);\r\n                            } else {\r\n                                alert(\"提交失败\");\r\n                            }\r\n                        });\r\n                    });\r\n\r\n                });  // end of $.get(\"user/findOne\"...\r\n\r\n                $(this).html(\"编辑\");\r\n                $(this).toggleClass(\"list-edit-btn\");\r\n                $(this).toggleClass(\"list-save-btn\");\r\n            });\r\n\r\n            //批量点击编辑按钮\r\n            $(\"#batch-edit-btn\").click(function(){\r\n                $(\".edit-btn\").click();\r\n            });\r\n            $(\"#batch-save-btn\").click(function(){\r\n                $(\".save-btn\").click();\r\n            });\r\n\r\n            //物品清单批量点击编辑按钮\r\n            $(\"#list-batch-edit-btn\").click(function(){\r\n                $(\".list-edit-btn\").click();\r\n            });\r\n            $(\"#list-batch-save-btn\").click(function(){\r\n                $(\".list-save-btn\").click();\r\n            });\r\n\r\n            // 申请单点击删除按钮，触发删除行脚本\r\n            $(document).on(\"click\",'.delete',function(){\r\n                $('#table').dataTable().fnDeleteRow($(this).closest('tr')[0]);\r\n            });\r\n            // 物品清单点击删除按钮，触发删除行脚本\r\n            $(document).on(\"click\",'.list-delete',function(){\r\n                $('#listTable').dataTable().fnDeleteRow($(this).closest('tr')[0]);\r\n            });\r\n\r\n\r\n            // 根据 申请当前状态的数值，设置前端表格的文字，以及对应行按钮是否可用\r\n            $(\"#table tbody tr\").each(function () {\r\n                var a = $(this).children();//获取每一行\r\n                var arr = a[5].innerText;//取得第六列的值\r\n                if(arr==='0'){\r\n                    a[5].innerText = '未提交';\r\n                }else if(arr==='1'){\r\n                    a[5].innerText = '已提交';\r\n                    a.find('.submit-btn').attr('disabled',true);\r\n                    a.find('.edit-btn').attr('disabled',true);\r\n                }else if(arr==='2'){\r\n                    a[5].innerText = '审核通过';\r\n                    a.find('.submit-btn').attr('disabled',true);\r\n                    a.find('.edit-btn').attr('disabled',true);\r\n                }else if(arr==='3'){\r\n                    a[5].innerText = '审核未通过';\r\n                }\r\n            })\r\n        });\r\n\r\n    } );\r\n\r\n\r\n\r\n</script>\r\n\r\n<script>\r\n    function fnClickAddRow() {\r\n        $('#table').dataTable().fnAddData([\r\n            \"\", \"\", \"\", \"\",\r\n            \"\", \"未提交\", \"\", \"\", \"\",\r\n            \"\", \"\"]);}\r\n    function listfnClickAddRow() {\r\n        $('#listTable').dataTable().fnAddData([\r\n            \"\", \"\", \"\", \"\",\r\n            \"\", \"\", \"\", \"\", \"\",\r\n            \"\", \"\"]);}\r\n</script>\r\n\r\n</body>\r\n</html>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/webapp/form_purchase.html b/src/main/webapp/form_purchase.html
--- a/src/main/webapp/form_purchase.html	(revision 855945133b8f01b67598a2f6ef2ea8348c09b16b)
+++ b/src/main/webapp/form_purchase.html	(date 1686232742764)
@@ -313,7 +313,7 @@
             var temp_list_data;
             var temp_order_id;  // 本条订单的order——id
 
-            // 点击 物品清单
+            // 点击物品清单
             $("table tbody").on("click",".list-btn",function (){
                 // TODO: 待办 - 进入物品清单弹窗，刷新表单
                 //$('#listTable').dataTable().api().draw();
@@ -601,8 +601,8 @@
                 if (tds[4].innerText !== "") front_end_data += "classification="+tds[4].innerText+"&";
                 if (tds[5].innerText !== "") front_end_data += "price="+tds[5].innerText+"&";
                 if (tds[6].innerText !== "") front_end_data += "expiration_time="+tds[6].innerText+"&";
-                if (tds[7].innerText !== "") front_end_data += "lower_limit="+tds[7].innerText+"&";
-                if (tds[8].innerText !== "") front_end_data += "upper_limit="+tds[8].innerText+"&";
+                if (tds[7].innerText !== "") front_end_data += "upper_limit="+tds[7].innerText+"&";
+                if (tds[8].innerText !== "") front_end_data += "lower_limit="+tds[8].innerText+"&";
                 if (tds[9].innerText !== "") front_end_data += "notes="+tds[9].innerText+"&";
                 //front_end_data = front_end_data.substring(0, front_end_data.length-1);  //删除最后一个字符
                 console.log("front_end_data"+front_end_data)
